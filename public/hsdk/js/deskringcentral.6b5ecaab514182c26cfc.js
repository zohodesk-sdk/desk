(window.deskappJsonp=window.deskappJsonp||[]).push([[93],{"./deskapp/audio/incoming.ogg":function(e,o,n){e.exports=n.p+"./fonts/incoming.d94a697c26b91b7639c7.ogg"},"./deskapp/audio/outgoing.ogg":function(e,o,n){e.exports=n.p+"./fonts/outgoing.67c57613792a5960707e.ogg"},"./src/telephony/providers/ringcentral/ringcentralnotifier.js":function(e,o,n){"use strict";n.r(o),n.d(o,"rcBindAction",function(){return C}),n.d(o,"rcInfo",function(){return _}),n.d(o,"rcTele",function(){return S});var t=n("../../../../npm-global/lib/node_modules/@zohodesk/react-cli/node_modules/babel-runtime/core-js/json/stringify.js"),r=n.n(t),c=n("./src/createAppStore.js"),l=n("./src/utils/getCSRFCookie.js"),a=n("./src/telephony/utils/index.js"),s=n("./src/telephony/constants/index.js"),i=n("./src/actions/index.js"),u=s.a.MIDDLEWARE,d=s.a.UPDATE_STATUS,g=Object(c.a)(),p=g.getState().routing.paramMap.orgName+"/";function C(){jQuery(document).off("unload.rcBind").on("unload.rcBind",function(){jQuery("#cticallnotification").is(":ui-callnotificationinit")&&("ringcentral"!==G_callObj.ctiname||""===$("#ctinotifier").html()||"callconnected"!==G_callObj.callstate&&"callreceived"!==G_callObj.callstate&&"proceedanswer"!==G_callObj.callstate||S.rcReloadLog())})}var m=void 0,f="",h=!1,I=!1,_={callid:"",ctinumber:"",custnumber:"",direction:"",callstate:"",starttime:"",sessionid:"",click2callnumber:"",contactid:"",caseid:"",activityid:""},b="",R="",L="",T="",v="",N="",y=[],P=void 0;rc_console=console;var S={subscribePresenceNotification:function(){rc_console.info("Going to subscribe for the presence notification"),(P=(P=rc_rcsdk.createSubscription()).setEventFilters(["/account/~/extension/~/presence?detailedTelephonyState=true"])).on(P.events.notification,function(e){S.presenceNotificationHandler(e)}),P.register().then(function(){S.resetLastCallInfo()}).catch(function(e){rc_console.error("[Error in subscribeWithRC] "+e.message)}),P.on(P.events.renewError,function(e){rc_console.log("RINGCENTRAL_SDK_LOG:::::renewError ---\x3e",e);var o="logtype=automaticRenewErrorEmit&rcphone="+encodeURIComponent(CTIAPI.LocalStorage.get("zsrc-login-username"))+"&rcextn="+encodeURIComponent(CTIAPI.LocalStorage.get("login-extension"));S.logRCDetails(o),S.subscribePresenceNotification()})},presenceNotificationHandler:function(e){var o=e.body.activeCalls;if(_.callstate=e.body.telephonyStatus,rc_console.log("RINGCENTRAL_SDK_LOG:::::presenceActiveCallsArray----\x3e",o,_.callstate,e.timestamp),"Ringing"!==_.callstate||CTIAPI.LocalStorage.has("rc_ringing"))if("CallConnected"!==_.callstate||CTIAPI.LocalStorage.has("rc_callconnected")||""===_.sessionid)if("NoCall"!==_.callstate||CTIAPI.LocalStorage.has("rc_callend")||""===_.sessionid){if("Ringing"===_.callstate||"CallConnected"===_.callstate||"NoCall"===_.callstate)return!1;var n=r()(e.body);a="logtype=unusedPresenceInfo&rcmessage="+encodeURIComponent(n)+"&rcphone="+encodeURIComponent(CTIAPI.LocalStorage.get("zsrc-login-username"))+"&custnumber="+encodeURIComponent(_.custnumber)+"&rc_sessionid="+_.sessionid;S.logRCDetails(a)}else S.zsNotificationHandler();else{CTIAPI.LocalStorage.put("rc_callconnected","true");for(var t=0;t<o.length;t++)if(o[t].sessionId===_.sessionid){if(""===_.custnumber){c=ZTwilio.Utils.removeSpecialChars(o[t].from),l=ZTwilio.Utils.removeSpecialChars(o[t].to);_.custnumber=c,_.ctinumber=l}S.zsNotificationHandler();break}}else{CTIAPI.LocalStorage.put("rc_ringing","true"),_.sessionid=o[0].sessionId,_.callstate=e.body.telephonyStatus,_.direction=o[0].direction,_.starttime=e.timestamp;var c=ZTwilio.Utils.removeSpecialChars(o[0].from),l=ZTwilio.Utils.removeSpecialChars(o[0].to);if("Outbound"===_.direction)if(l===CTIAPI.LocalStorage.get("zsrc-login-username")){if(!CTIAPI.LocalStorage.has("isRCInvalidOutboundLogged")){CTIAPI.LocalStorage.put("isRCInvalidOutboundLogged","true");var a="logtype=rcInvalidOutboundLog&callrefid="+encodeURIComponent(_.callid)+"&ctinumber="+encodeURIComponent(c)+"&custnumber="+encodeURIComponent(l)+"&rcphone="+encodeURIComponent(CTIAPI.LocalStorage.get("zsrc-login-username"))+"&rc_sessionid="+encodeURIComponent(_.sessionid)+"&calltype="+encodeURIComponent(_.direction);S.logRCDetails(a)}rc_console.info("In outbound call customerNumber should not be same as RC number, so assigning value manually"),_.custnumber=_.click2callnumber,_.ctinumber=CTIAPI.LocalStorage.get("zsrc-login-username")}else _.ctinumber=c||CTIAPI.LocalStorage.get("zsrc-login-username"),_.custnumber=l;else if("Inbound"===_.direction){if(c===CTIAPI.LocalStorage.get("zsrc-login-username")){if(!CTIAPI.LocalStorage.has("isRCInvalidInboundLogged")){CTIAPI.LocalStorage.put("isRCInvalidInboundLogged","true");var a="logtype=rcInvalidInboundLog&callrefid="+encodeURIComponent(_.callid)+"&ctinumber="+encodeURIComponent(l)+"&custnumber="+encodeURIComponent(c)+"&rcphone="+encodeURIComponent(CTIAPI.LocalStorage.get("zsrc-login-username"))+"&rc_sessionid="+encodeURIComponent(_.sessionid)+"&calltype="+encodeURIComponent(_.direction);S.logRCDetails(a)}return rc_console.info("In inbound call customerNumber should not be same as RC number, so do nothing"),!1}_.custnumber=c,_.ctinumber=l||CTIAPI.LocalStorage.get("zsrc-login-username")}_.custnumber=ZTwilio.Utils.removeSpecialChars(_.custnumber),_.ctinumber=ZTwilio.Utils.removeSpecialChars(_.ctinumber),S.zsNotificationHandler()}},rcOauthResponseReceiver:function(e){rc_console.log("RINGCENTRAL_SDK_LOG:::::code ---\x3e",e),S.authorizeSuccess(e.code)},loginToRingcentral:function(){var e=$("#rcredirecturl").val(),o={};o.redirectUri=e;var n="/support/"+p+"RingCentral.do",t="mode=getRCStateParam&"+Object(l.b)()+"="+encodeURIComponent(Object(l.a)());jQuery.ajax({url:n,cache:!1,type:"POST",data:t,success:function(e){if(""!==e&&void 0!==e){rc_console.log("RINGCENTRAL_SDK_LOG::: state param ==>",e);var n=e;o.state=n;var t=rc_platform.loginUrl(o);m=window.open(t,"ringcentralLoginWindow","location=0,status=0,width=800,height=600,left=300,top=100"),jQuery(".bl-freezelayer,#rcLoginContainer,#rcLoginBtn").hide()}}})},authorizeSuccess:function(e){var o=$("#rcredirecturl").val();rc_platform.login({code:e,redirectUri:o}).then(function(e){m.close(),S.subscribePresenceNotification(),g.dispatch(Object(i.Q)({type:"success",message:getI18NValue("support.rc.label.login.success")}));var o="logtype=rcLoginDetails";if(rc_platform.get("/account/~").then(function(e){var n=null;try{n=e.json().serviceInfo.servicePlan.edition}catch(e){rc_console.error("[Error in getting edition type of user] "+e.message)}o+="&edition="+n,rc_console.log("RINGCENTRAL_SDK_LOG:::::edition ==>",n),S.logRCDetails(o)}).catch(function(e){rc_console.error("[Error in calling Ring Central Api Accounts] "+e.message)}),jQuery(".zd-tc-bl-freezelayer,#rcLoginContainer,#rcLoginBtn").hide(),S.updateRCUserStatus(UserPhoneStatus.WEB_ONLINE),"undefined"!=typeof CrmPlusImpl&&CrmPlusImpl.isLoadedInCrmplus()){var n=S.crmplusAllRCStatus(UserPhoneStatus.WEB_ONLINE);CrmPlusImpl.trigger("setPhoneAgentStatus",[n])}}).catch(function(e){g.dispatch(Object(i.Q)({type:"alert",message:getI18NValue("support.rc.error.msg4")})),rc_console.error("[Error in loginToRingcentral] "+e.message)})},isLoggedInSuccessProcess:function(){if(S.subscribePresenceNotification(),"Browser"===CTIAPI.LocalStorage.get("zsrc-login-username")&&rcWebRTC.initWebRTC(),S.fetchRCPreferenceDetails(),CTIAPI.LocalStorage.get("zsrc-login-username")||setTimeout(function(){S.showRCPreference()},5e3),"undefined"!=typeof CrmPlusImpl&&CrmPlusImpl.isLoadedInCrmplus()){var e=Object(a.phoneStatusMapping)(g.getState().telephony.channelStatus);e=e||101;var o=S.crmplusAllRCStatus(e);CrmPlusImpl.trigger("setPhoneAgentStatus",[o])}},listionPlatformEvents:function(){rc_platform.on(rc_platform.events.refreshError,function(){rc_console.log("RINGCENTRAL_SDK_LOG:::::refreshError ---\x3e",arguments),S.updateRCstatusImage(UserPhoneStatus.WEB_OFFLINE)}),rc_platform.on(rc_platform.events.logoutSuccess,function(){rc_console.log("RINGCENTRAL_SDK_LOG:::::logoutSuccess ---\x3e",arguments)}),rc_platform.on(rc_platform.events.loginSuccess,function(){rc_console.log("RINGCENTRAL_SDK_LOG:::::loginSuccess ---\x3e",arguments),S.fetchRCPreferenceDetails(),CTIAPI.LocalStorage.get("zsrc-login-username")||setTimeout(function(){S.showRCPreference()},5e3)}),rc_platform.on(rc_platform.events.loginError,function(){rc_console.log("RINGCENTRAL_SDK_LOG:::::loginError ---\x3e",arguments)})},logOut:function(){rc_platform.logout().then(function(){g.dispatch(Object(i.Q)({type:"success",message:getI18NValue("support.rc.label.logout.success")})),CTIAPI.LocalStorage.remove("zsrc-login-username"),S.destroy(),S.updateRCUserStatus(UserPhoneStatus.WEB_OFFLINE)}).catch(function(e){rc_console.error("[Error in Logout] "+e.message)})},getCurrentCallLog:function(){if(rc_console.log("RINGCENTRAL_SDK_LOG:::::Going to get calldetails from recent call logs using calllog-id ="+_.callid+", and sessionid ="+_.sessionid),""!==_.sessionid&&!CTIAPI.LocalStorage.has("rc_callend")){if(CTIAPI.LocalStorage.has("rc_activecalls_api_count")){var e=parseInt(CTIAPI.LocalStorage.get("rc_activecalls_api_count"))+1;CTIAPI.LocalStorage.put("rc_activecalls_api_count",e)}else CTIAPI.LocalStorage.put("rc_activecalls_api_count","0");rc_platform.get("/account/~/extension/~/active-calls",{query:{dateFrom:S.getDateinyyyymmdd(),page:1,perPage:5}}).then(function(e){var o=e.json().records;rc_console.log("RINGCENTRAL_SDK_LOG:::::[active-calls] Response received from recent call logs=>",o);for(var n=!1,t=0;t<o.length;t++)if(o[t].sessionId===_.sessionid){rc_console.log("RINGCENTRAL_SDK_LOG:::::[active-calls] CurrentCallLog details =>",o[t]),S.doCallEndProcess(o[t]),n=!0;break}n||S.manualCallEndProcess()}).catch(function(e){rc_console.error("[Error in getCurrentCallLog] "+e.message),T=e.message,O.stop(),E.stop(),S.manualCallEndProcess()})}},checkPresence:function(){rc_platform.get("/account/~/extension/~/presence").then(function(e){var o=e.json();if(rc_console.log("RINGCENTRAL_SDK_LOG:::::[presence-poll] checkPresence =>",o),b=r()(o),o.presenceStatus){var n=o.presenceStatus,t=o.telephonyStatus;"Available"===n&&"NoCall"===t&&(rc_console.info("[presence-poll] Going to do callend process via presence timer"),S.getCurrentCallLog())}}).catch(function(e){rc_console.error("[Error in presenceHelper] "+e.message),L=e.message})},doRingoutProcess:function(e,o){var n=$(e).attr("phoneNum");if(!CTIAPI.LocalStorage.get("zsrc-login-username"))return S.showRCPreference(),!1;_.click2callnumber=n;var t=$(e).attr("module");if("RequestDetailsView"==t?(_.contactid=jQuery("#secContactId_"+jQuery("#caseId").val()).val(),_.caseid=jQuery("#caseId").val()):"ReminderPopup"==t?(_.contactid=$(e).attr("zsContactId"),_.caseid=$(e).attr("zsRequestId"),_.activityid=$(e).attr("zsActivityId")):_.contactid=jQuery("#secEntityId").val(),"Browser"===CTIAPI.LocalStorage.get("zsrc-login-username"))rcWebRTC.makeCall(_.click2callnumber);else{var r="/support/"+p+"RingCentral.do",c="mode=checkPlayPrompt&"+Object(l.b)()+"="+encodeURIComponent(Object(l.a)());$.ajax({url:r,cache:!1,type:"POST",data:c,success:function(e){"true"==e?S.initiateRingout({from:{phoneNumber:CTIAPI.LocalStorage.get("zsrc-login-username")},to:{phoneNumber:_.click2callnumber},playPrompt:!1}):S.initiateRingout({from:{phoneNumber:CTIAPI.LocalStorage.get("zsrc-login-username")},to:{phoneNumber:_.click2callnumber},playPrompt:!0})}})}},initiateRingout:function(e){rc_platform.post("/account/~/extension/~/ringout",e).then(function(e){if(rc_console.log("RINGCENTRAL_SDK_LOG:::::ringout response =>",e),f=e.json(),rc_console.log("RINGCENTRAL_SDK_LOG:::::[ringout-poll] First status:",f.status.callStatus),f.uri){var o="logtype=ringoutSuccessDetails&ringouturi="+encodeURIComponent(f.uri)+"&rcphone="+encodeURIComponent(CTIAPI.LocalStorage.get("zsrc-login-username"))+"&custnumber="+encodeURIComponent(ZTwilio.Utils.removeSpecialChars(_.click2callnumber));S.logRCDetails(o)}S.logRingOutPollInfo()}).catch(function(e){rc_console.error("[Error in rc_ringout] "+e.message);var o="logtype=ringoutErrorDetails&rcmessage="+encodeURIComponent(e.message)+"&rcphone="+encodeURIComponent(CTIAPI.LocalStorage.get("zsrc-login-username"))+"&custnumber="+encodeURIComponent(ZTwilio.Utils.removeSpecialChars(_.click2callnumber));S.logRCDetails(o)})},logRingOutPollInfo:function(){setTimeout(function(){f.status&&"InProgress"!==f.status.callStatus||rc_platform.get(f.uri).then(function(e){if(f=e.json(),rc_console.log("RINGCENTRAL_SDK_LOG:::::[ringout-poll] Current status:",f.status),"Success"===f.status.callStatus&&(_.callstate="CallConnected",h=!0,S.zsNotificationHandler()),"InProgress"!==f.status.callStatus){"CannotReach"===f.status.callStatus&&(I=!0,S.ShowClick2CallErrorMsg(f.status),$("#cticallnotification").is(":ui-callnotificationinit")&&Telephony.Notification.destroyNotification()),"Error"===f.status.callStatus&&(I=!0,S.ShowClick2CallErrorMsg(f.status),$("#cticallnotification").is(":ui-callnotificationinit")&&Telephony.Notification.destroyNotification());var o=r()(f.status),n="logtype=logRingoutPollInfo&rcmessage="+encodeURIComponent(o)+"&rcphone="+encodeURIComponent(CTIAPI.LocalStorage.get("zsrc-login-username"))+"&custnumber="+encodeURIComponent(_.custnumber)+"&rc_sessionid="+_.sessionid;S.logRCDetails(n)}S.logRingOutPollInfo()}).catch(function(e){rc_console.error(e.message)})},1e3)},ShowClick2CallErrorMsg:function(e){var o="";"CannotReach"===e.callStatus?"NoAnswer"===e.callerStatus?"Rejected"!==e.calleeStatus&&"InProgress"!==e.calleeStatus||(o="No Answer in your RingCentral Phone. Attend the call in your RingCentral Phone and press 1."):"Rejected"===e.callerStatus?"Finished"===e.calleeStatus&&(o="Call was rejected in your RingCentral Phone."):"Success"===e.callerStatus?"GenericError"===e.calleeStatus?o="Invalid Phone Number. Please check the number.":"NoAnswer"===e.calleeStatus?o="No Answer from customer. Please try after some time.":"Busy"===e.calleeStatus&&(o="Customer is busy. Please try after some time."):"GenericError"!==e.callerStatus&&"Busy"!==e.callerStatus||("Success"===e.calleeStatus?o="Your RingCentral phone is not reachable. Please login to your RingCentral Phone.":"GenericError"===e.calleeStatus&&(o="Please attend the call in your RingCentral Phone.")):"Error"===e.callStatus&&(o="Please attend the call in your RingCentral Phone."),""!==o&&S.showErrorMsg(o)},showErrorMsg:function(e){var o='<div class="custom-hd-popup transformscale1">';o+='<div class="red-hd-popup">',o+='<header class="SLALink f15"><span class="i-tag mr10"><i class="icon-blocked f25"></i></span>'+getI18NValue("support.rc.error.msg1")+"</header>",o+='<div class="red-message"><span id="rcClick2CallErrorMsg">'+e+'</span><div class="clboth"></div>',o+='<a id="back-url"><input type="button" class="zd-tc-blue-btn zd-tc-mt20" style="padding:5px 30px !important" value="Ok" onclick=\'jQuery(".zd-tc-bl-freezelayer,#rcClick2CallErrorContainer").hide();\'></a>',o+="</div></div></div>",$("#rcClick2CallErrorContainer").children(".custom-hd-popup").remove(),jQuery("#rcClick2CallErrorContainer").append(o),jQuery(".zd-tc-bl-freezelayer,#rcClick2CallErrorContainer").show()},hangUp:function(){clearTimeout(null),f.status&&"InProgress"===f.status.callStatus&&rc_platform.delete(f.uri).catch(function(e){rc_console.error(e.message)}),f=""},zsNotificationHandler:function(){if(""===_.custnumber||void 0===_.custnumber)return rc_console.log("RINGCENTRAL_SDK_LOG:::::As customer number is empty can't do anything"),!1;if("Inbound"===_.direction&&Object(a.phoneStatusMapping)(g.getState().telephony.channelStatus)===UserPhoneStatus.WEB_BUSY)return rc_console.log("RINGCENTRAL_SDK_LOG:::::As RC status is DND do not show inbound notification"),!1;if("CallConnected"===_.callstate&&"Outbound"===_.direction&&""===$("#ctinotifier").html()&&(_.callstate="Ringing"),"Ringing"===_.callstate){if(rc_console.info("Going to start presence and call-log timer"),O.start(),E.start(),CTIAPI.LocalStorage.has("on_reload_sessionid")){var e=CTIAPI.LocalStorage.get("on_reload_sessionid");""!==e&&void 0!==e&&S.getFailedCallLogDataBySessionid(e)}var o="/support/"+p+"RingCentral.do",n="mode=ringcentralHandler&callstate="+_.callstate+"&custnumber="+encodeURIComponent(_.custnumber)+"&ctinumber="+encodeURIComponent(_.ctinumber)+"&calltype="+_.direction+"&callrefid="+_.callid+"&starttime="+_.starttime+"&rc_sessionid="+_.sessionid+"&"+Object(l.b)()+"="+encodeURIComponent(Object(l.a)());"Outbound"===_.direction&&(""!==_.contactid&&void 0!==_.contactid&&(n+="&zscontactid="+encodeURIComponent(_.contactid)),""!==_.caseid&&void 0!==_.caseid&&(n+="&zscaseid="+encodeURIComponent(_.caseid)),""!==_.activityid&&void 0!==_.activityid&&(n+="&zsactivityid="+encodeURIComponent(_.activityid))),rc_console.log("RINGCENTRAL_SDK_LOG:::::[rc-notification] Dataparams on ringing =>"+r()(n)),$.ajax({url:o,cache:!1,type:"POST",data:n,success:function(e){}})}else if("CallConnected"===_.callstate){if(""!==$("#ctinotifier").html()){if("Browser"===CTIAPI.LocalStorage.get("zsrc-login-username")&&(h=!0,Telephony.CallBack.answerSuccess()),(""!==_.click2callnumber||CTIAPI.get("fromcontactDV"))&&"Outbound"===_.direction&&!h)return;o="/support/"+p+"RingCentral.do",n="mode=ringcentralHandler&callstate="+_.callstate+"&custnumber="+encodeURIComponent(_.custnumber)+"&ctinumber="+encodeURIComponent(_.ctinumber)+"&calltype="+_.direction+"&callrefid="+_.callid+"&starttime="+_.starttime+"&rc_sessionid="+_.sessionid+"&"+Object(l.b)()+"="+encodeURIComponent(Object(l.a)());rc_console.log("RINGCENTRAL_SDK_LOG:::::[rc-notification] Dataparams on callconnected =>"+r()(n)),$.ajax({url:o,cache:!1,type:"POST",data:n,success:function(e){}})}else{if(CTIAPI.LocalStorage.has("rc_ringing"))return rc_console.log("RINGCENTRAL_SDK_LOG:::::As ringing is already notified in other tab don't need to do anything"),!1;CTIAPI.LocalStorage.put("rc_ringing","true"),rc_console.log("RINGCENTRAL_SDK_LOG:::::As ringing notification not happened we are handling it in callconnected state-----");o="/support/"+p+"RingCentral.do",n="mode=ringcentralHandler&callstate=Ringing&isStartTimer=true&custnumber="+encodeURIComponent(_.custnumber)+"&ctinumber="+encodeURIComponent(_.ctinumber)+"&calltype="+_.direction+"&callrefid="+_.callid+"&starttime="+_.starttime+"&rc_sessionid="+_.sessionid+"&"+Object(l.b)()+"="+encodeURIComponent(Object(l.a)());rc_console.log("RINGCENTRAL_SDK_LOG:::::[rc-notification] Dataparams on missed ringing handling at callconnected state =>"+r()(n)),$.ajax({url:o,cache:!1,type:"POST",data:n,success:function(e){}})}S.getCallLogBySessionid(_.sessionid,function(e){e&&(R=r()(e))})}else"NoCall"===_.callstate&&setTimeout(function(){rc_console.info("[rc-notification] Going to do callend process via RC notification"),S.getCurrentCallLog()},1e3)},doCallEndProcess:function(e){if(rc_console.log("RINGCENTRAL_SDK_LOG:::::Call log Handler, callObj.sessionid="+e.sessionId),CTIAPI.LocalStorage.has("rc_callend"))return rc_console.log("RINGCENTRAL_SDK_LOG:::::As callend is already notified in other tab don't need to do anything"),!1;CTIAPI.LocalStorage.put("rc_callend","true");var o=e.direction;"Inbound"===o?S.inboundCallEndProcess(e):"Outbound"===o&&S.outboundCallEndProcess(e)},inboundCallEndProcess:function(e){if(rc_console.log("RINGCENTRAL_SDK_LOG:::::IncomingCalllogHandler. callObj.result="+e.result),_.sessionid===e.sessionId){var o=e.direction,n=e.from.phoneNumber?e.from.phoneNumber:e.from.extensionNumber?e.from.extensionNumber:_.custnumber,t=e.to.phoneNumber?e.to.phoneNumber:CTIAPI.LocalStorage.get("zsrc-login-username");n=ZTwilio.Utils.removeSpecialChars(n),t=ZTwilio.Utils.removeSpecialChars(t);var c=e.result,a=e.id,s=e.duration,i=e.startTime,u=e.sessionId;null!=s&&""!==s||(s=Telephony.Utils.getTimeInSeconds()),"Missed"!==e.result&&"Rejected"!==e.result&&"In Progress"!==e.result&&"Voicemail"!==e.result&&1!==s||(s=0),rc_console.log("RINGCENTRAL_SDK_LOG:::::-----ZC CALLEND process-----"),rcWebRTC.onCallEndCallBack();var d="/support/"+p+"RingCentral.do",g="mode=ringcentralHandler&callstate=NoCall&custnumber="+encodeURIComponent(n)+"&ctinumber="+encodeURIComponent(t)+"&calltype="+o+"&callresult="+c+"&callrefid="+a+"&callduration="+s+"&starttime="+i+"&rc_sessionid="+u+"&"+Object(l.b)()+"="+encodeURIComponent(Object(l.a)());rc_console.log("RINGCENTRAL_SDK_LOG:::::[rc-notification] Dataparams on inbound callend =>"+r()(g)),$.ajax({url:d,cache:!1,type:"POST",data:g,success:function(e){S.resetLastCallInfo()}}),Telephony.Notification.hideTelephonyLoading()}},outboundCallEndProcess:function(e){if(rc_console.log("RINGCENTRAL_SDK_LOG:::::OutgoingCalllogHandler. callObj.result="+e.result),_.sessionid===e.sessionId){var o=e.direction,n=e.to.phoneNumber?e.to.phoneNumber:e.to.extensionNumber?e.to.extensionNumber:_.custnumber,t=CTIAPI.LocalStorage.get("zsrc-login-username");n=ZTwilio.Utils.removeSpecialChars(n),t=ZTwilio.Utils.removeSpecialChars(t);var c=e.result,a=e.id,s=e.duration,i=e.startTime,u=e.sessionId;null!=s&&""!==s||(s=Telephony.Utils.getTimeInSeconds()),("Busy"===e.result||"Hang Up"===e.result||"No Answer"===e.result||I||"Voicemail"===e.result||1===s)&&(s=0),rc_console.log("RINGCENTRAL_SDK_LOG:::::-----ZC CALLEND process-----");var d="/support/"+p+"RingCentral.do",g="mode=ringcentralHandler&callstate=NoCall&custnumber="+encodeURIComponent(n)+"&ctinumber="+encodeURIComponent(t)+"&calltype="+o+"&callresult="+c+"&callrefid="+a+"&callduration="+s+"&starttime="+i+"&rc_sessionid="+u+"&"+Object(l.b)()+"="+encodeURIComponent(Object(l.a)());rc_console.log("RINGCENTRAL_SDK_LOG:::::[rc-notification] Dataparams on outbound callend =>"+r()(g)),$.ajax({url:d,cache:!1,type:"POST",data:g,success:function(e){S.resetLastCallInfo()}}),Telephony.Notification.hideTelephonyLoading()}},manualCallEndProcess:function(){if(""!==_.sessionid){if(CTIAPI.LocalStorage.has("rc_callend"))return rc_console.log("RINGCENTRAL_SDK_LOG:::::As callend is already notified in other tab don't need to do anything"),!1;CTIAPI.LocalStorage.put("rc_callend","true"),rc_console.log("RINGCENTRAL_SDK_LOG:::::As we could not get calllog from RC we are going to do manual callend process");var e=_.direction,o=_.custnumber,n=_.ctinumber,t=_.callid,r=_.starttime,c=_.sessionid,a=Telephony.Utils.getTimeInSeconds();1===a&&(a=0);var s="/support/"+p+"RingCentral.do",i="mode=ringcentralHandler&callstate=NoCall&custnumber="+encodeURIComponent(o)+"&ctinumber="+encodeURIComponent(n)+"&calltype="+e+"&callresult=Completed&callrefid="+t+"&callduration="+a+"&starttime="+r+"&rc_sessionid="+c+"&"+Object(l.b)()+"="+encodeURIComponent(Object(l.a)());rc_console.log("RINGCENTRAL_SDK_LOG:::::[rc-notification] Dataparams on manualCallEndProcess =>"+i),jQuery.ajax({url:s,cache:!1,type:"POST",data:i,success:function(e){S.resetLastCallInfo()}}),Telephony.Notification.hideTelephonyLoading()}},pollCurrentCallLog:function(){var e=_.sessionid;if(rc_console.log("RINGCENTRAL_SDK_LOG:::::Going to poll CurrentCallLog using sessionid ="+e),""!==e&&void 0!==e){if(CTIAPI.LocalStorage.has("rc_activecalls_api_count")){var o=parseInt(CTIAPI.LocalStorage.get("rc_activecalls_api_count"))+1;CTIAPI.LocalStorage.put("rc_activecalls_api_count",o)}else CTIAPI.LocalStorage.put("rc_activecalls_api_count","0");rc_platform.get("/account/~/extension/~/active-calls",{query:{dateFrom:S.getDateinyyyymmdd(),page:1,perPage:5}}).then(function(o){var n=o.json().records;rc_console.log("RINGCENTRAL_SDK_LOG:::::[activecall-log-poll] Response received from recent call logs=>",n);for(var t=0;t<n.length;t++)if(n[t].sessionId===e){rc_console.log("RINGCENTRAL_SDK_LOG:::::[activecall-log-poll] pollCurrentCallLog details =>",n[t]);var r=n[t],c=r.duration;if(rc_console.log("RINGCENTRAL_SDK_LOG:::::callduration=>",c),null==c||""===c){rc_console.info("[activecall-log-poll] The current call is not ended yet so do nothing...");break}rc_console.info("Going to do callend process via call-log timer"),S.doCallEndProcess(r);break}}).catch(function(e){rc_console.error("[Error in pollCurrentCallLog] "+e.message)})}},resetLastCallInfo:function(){rc_console.info("Going to reset LastCallInfo"),_.callid="",_.ctinumber="",_.custnumber="",_.direction="",_.callstate="",_.sessionid="",_.click2callnumber="",f="",h=!1,I=!1,_.contactid="",_.caseid="",_.activityid="",CTIAPI.LocalStorage.remove("isRCInvalidInboundLogged"),CTIAPI.LocalStorage.remove("isRCInvalidOutboundLogged"),CTIAPI.LocalStorage.remove("rc_ringing"),CTIAPI.LocalStorage.remove("rc_callconnected"),CTIAPI.LocalStorage.remove("rc_callend"),CTIAPI.LocalStorage.put("rc_activecalls_api_count","0"),O.stop(),E.stop()},destroy:function(){void 0!==P&&P.reset().off()},getDateinyyyymmdd:function(){var e=new Date,o=e.getFullYear().toString(),n=(e.getMonth()+1).toString(),t=e.getDate().toString();return o+"-"+(n[1]?n:"0"+n[0])+"-"+(t[1]?t:"0"+t[0])},logRCDetails:function(e){var o="/support/"+p+"RingCentral.do",n="mode=logRCDetails&"+e+"&"+Object(l.b)()+"="+encodeURIComponent(Object(l.a)());jQuery.ajax({url:o,cache:!1,type:"POST",data:n,success:function(){}})},getCallLogs:function(){rc_platform.get("/account/~/extension/~/call-log").then(function(e){rc_console.log("RINGCENTRAL_SDK_LOG:::::[call-log] getCallLogs full records =>",e.json().records)}).catch(function(e){rc_console.error("[Error in getCallLogs] "+e.message)})},getPresence:function(e){rc_platform.get("/account/~/extension/~/presence").then(function(o){var n=o.json();rc_console.log("RINGCENTRAL_SDK_LOG:::::[presence] getPresence =>",n),jQuery.isFunction(e)&&e(n)}).catch(function(e){rc_console.error("[Error in getPresence] "+e.message)})},getCallLogBySessionid:function(e,o){var n=e;rc_console.log("RINGCENTRAL_SDK_LOG:::::Going to get CurrentCallLog using sessionid ="+n),""!==n&&void 0!==n&&rc_platform.get("/account/~/extension/~/active-calls").then(function(e){var t=e.json().records;rc_console.log("RINGCENTRAL_SDK_LOG:::::[active-calls] Response received from active-calls api=>",t);for(var r=!1,c=0;c<t.length;c++)if(t[c].sessionId===n){var l=t[c];rc_console.log("RINGCENTRAL_SDK_LOG:::::[active-calls] getCallLogBySessionid details =>",l),jQuery.isFunction(o)&&o(l),r=!0;break}r||rc_platform.get("/account/~/extension/~/call-log",{query:{dateFrom:S.getDateinyyyymmdd(),page:1,perPage:20}}).then(function(e){var t=e.json().records;rc_console.log("RINGCENTRAL_SDK_LOG:::::[call-log] Response received from call-log api=>",t);for(var r=0;r<t.length;r++)if(t[r].sessionId===n){var c=t[r];rc_console.log("RINGCENTRAL_SDK_LOG:::::[call-log] getCallLogBySessionid details =>",c),jQuery.isFunction(o)&&o(c);break}})}).catch(function(e){rc_console.error("[Error in getCallLogBySessionid] "+e.message)})},getFailedCallLogDataBySessionid:function(e){S.getCallLogBySessionid(e,function(o){if(o){var n=r()(o);S.logFailedCallData(n,e)}})},logFailedCallData:function(e,o){var n="logtype=logFailedCallData&oldPollCallLogData="+e+"&rc_sessionid="+encodeURIComponent(o)+"&rcphone="+encodeURIComponent(CTIAPI.LocalStorage.get("zsrc-login-username"));S.logRCDetails(n),CTIAPI.LocalStorage.remove("on_reload_sessionid")},rcReloadLog:function(){if(""!==_.sessionid){CTIAPI.LocalStorage.put("on_reload_sessionid",_.sessionid);var e=Telephony.Utils.getTimeInSeconds(),o="logtype=rcReloadLog&callrefid="+encodeURIComponent(_.callid)+"&ctinumber="+encodeURIComponent(_.ctinumber)+"&custnumber="+encodeURIComponent(_.custnumber)+"&rcphone="+encodeURIComponent(CTIAPI.LocalStorage.get("zsrc-login-username"))+"&rc_sessionid="+encodeURIComponent(_.sessionid)+"&calltype="+encodeURIComponent(_.direction);o+="&oldPollPresenceData="+b+"&newPollPresenceData="+newPPData+"&newPollCallLogData="+newPCLog,o+="&oldPollPresenceErrorMsg="+L+"&rc_starttime="+encodeURIComponent(_.starttime)+"&callduration="+e,o+="&oldPollCallLogData="+R+"&oldPollCallLogErrorMsg="+T,S.logRCDetails(o)}},showLoginPopup:function(){var e="/support/"+p+"RingCentral.do",o="mode=isShowLoginPopup&"+Object(l.b)()+"="+encodeURIComponent(Object(l.a)());jQuery.ajax({url:e,cache:!1,type:"POST",data:o,success:function(e){if("false"===e&&(jQuery(".zd-tc-bl-freezelayer,#rcLoginContainer").show(),"undefined"!=typeof CrmPlusImpl&&CrmPlusImpl.isLoadedInCrmplus())){CrmPlusImpl.trigger("pushNotification",[{type:"message",subtype:"showphoneloginpopup"}])}}})},enableRC:function(){freezeBackground(),jQuery(".zd-tc-freezeLayer").show();var e=jQuery("input[name='isCreateMissedCallTicket']").is(":checked"),o=jQuery("#createMissedCallFor").val(),n="/support/"+p+"RingCentral.do",t="mode=enableRingCentral&ctiname=ringcentral&isCreateMissedCallTicket="+e+"&createMissedCallFor="+o+"&"+Object(l.b)()+"="+encodeURIComponent(Object(l.a)());jQuery.ajax({url:n,cache:!1,type:"POST",data:t,success:function(e){"success"===e&&(window.location.hash="#setup/channels/phone",window.location.reload())}})},disableRC:function(){var e="/support/"+p+"RingCentral.do",o="mode=disableRingCentral&ctiname=ringcentral&"+Object(l.b)()+"="+encodeURIComponent(Object(l.a)());jQuery.ajax({url:e,cache:!1,type:"POST",data:o,success:function(e){"success"===e&&(rc_platform.logout(),"undefined"!=typeof CrmPlusImpl&&CrmPlusImpl.isLoadedInCrmplus()&&CrmPlusImpl.trigger("removeAgentStatus",["phone"]),setTimeout(function(){window.location.reload()},2e3))}})},saveRCMissedTicketCreation:function(){if("ringcentral"===g.getState().telephony.telephonyProviderName){var e=jQuery("input[name='isCreateMissedCallTicket']").is(":checked"),o=jQuery("#createMissedCallFor").val(),n="/support/"+p+"RingCentral.do",t="mode=saveRCMissedTicketCreation&isCreateMissedCallTicket="+e+"&createMissedCallFor="+o+"&"+Object(l.b)()+"="+encodeURIComponent(Object(l.a)());jQuery.ajax({url:n,cache:!1,type:"POST",data:t,success:function(e){g.dispatch(Object(i.Q)({type:"success",message:getI18NValue("crm.massupdate.updatedsuccesfully")}))}})}},updateRCUserStatus:function(e,o){var n="/support/"+p+"RingCentral.do",t="mode=updateRCUserStatus&currentstatus="+e+"&"+Object(l.b)()+"="+encodeURIComponent(Object(l.a)());jQuery.ajax({url:n,cache:!1,type:"POST",data:t,success:function(){jQuery.isFunction(o)&&o()}})},statusChangeProcess:function(e,o){var n=parseInt(e);n===UserPhoneStatus.WEB_OFFLINE?(S.updateRCUserStatus(n,o),S.logOut(),S.destroy()):-1===n?jQuery(".zd-tc-bl-freezelayer,#rcLoginContainer").show():n!==UserPhoneStatus.WEB_ONLINE&&n!==UserPhoneStatus.WEB_BUSY||S.updateRCUserStatus(n,o)},updateRCstatusImage:function(e){e=parseInt(e),g.dispatch({type:u+"/"+d,data:Object(a.codeToStatusMapper)(e,s.c)})},loginLaterProcess:function(){jQuery(".zd-tc-bl-freezelayer,#rcLoginContainer").hide();var e="/support/"+p+"RingCentral.do",o="mode=hideLoginPopup&"+Object(l.b)()+"="+encodeURIComponent(Object(l.a)());jQuery.ajax({url:e,cache:!1,type:"POST",data:o,success:function(){}})},selectRingOutNo:function(e){var o=jQuery(e).attr("rcphone"),n=jQuery(e).attr("rcdisplay");"customphone"===o?(jQuery("#rc_custom_phone_div").show(),jQuery("#rcringoutnumber").html(n),jQuery("#rcringoutnumber").attr("value","Custom Number"),jQuery("#rcbrowsercallerid_div").hide()):(jQuery("#rcringoutnumber").html(n),jQuery("#rcringoutnumber").attr("value",o),jQuery("#rc_custom_phone_div").hide(),jQuery("#rc_custom_phone_errormsg").hide(),jQuery("#rcbrowsercallerid_div").hide()),"Browser"===o&&(""===$("#rcbrowsercallerid").attr("value")&&jQuery("#rcbrowsercalleridsdropdown div[rcphone='"+N+"']").trigger("click"),jQuery("#rcbrowsercallerid_div").show()),setTimeout(function(){jQuery("#rcprefdropdown").addClass("hide")},100)},selectBrowserCallerid:function(e){var o=jQuery(e).attr("rcphone"),n=jQuery(e).attr("rcdisplay");jQuery("#rcbrowsercallerid").html(n),jQuery("#rcbrowsercallerid").attr("value",o),setTimeout(function(){jQuery("#rcbrowsercalleridsdropdown").addClass("hide")},100)},fetchRCPreferenceDetails:function(){var e=jQuery("#rcprefdropdown"),o=jQuery("#rcbrowsercalleridsdropdown"),n=[],t=[];rc_platform.get("/account/~/extension/~").then(function(r){var c=r.json().extensionNumber;rc_platform.get("/account/~/extension/~/phone-number").then(function(r){for(var l=r.json().records,a=0;a<l.length;a++)if(""!==l[a].phoneNumber&&void 0!==l[a].phoneNumber&&$.inArray("CallerId",-1!=l[a].features)&&"MainCompanyNumber"===l[a].usageType){var s=l[a].phoneNumber.concat(" * "+c);N=l[a].phoneNumber,v=l[a].phoneNumber.concat("*"+c),y.push(v),n.push("<div rcphone="+v+' rcdisplay="'+s+'" onclick="rcTele.selectRingOutNo(this)">'+s+"</div>"),t.push("<div rcphone="+l[a].phoneNumber+' rcdisplay="'+l[a].phoneNumber+'" onclick="rcTele.selectBrowserCallerid(this)">'+l[a].phoneNumber+"</div>")}else""!==l[a].phoneNumber&&void 0!==l[a].phoneNumber&&$.inArray("CallerId",-1!=l[a].features)&&"DirectNumber"===l[a].usageType?(y.push(l[a].phoneNumber),n.push("<div rcphone="+l[a].phoneNumber+' rcdisplay="'+l[a].phoneNumber+' (Direct)" onclick="rcTele.selectRingOutNo(this)">'+l[a].phoneNumber+'<span class="fright">(Direct)</span></div>'),t.push("<div rcphone="+l[a].phoneNumber+' rcdisplay="'+l[a].phoneNumber+'" onclick="rcTele.selectBrowserCallerid(this)">'+l[a].phoneNumber+"</div>")):""!==l[a].phoneNumber&&void 0!==l[a].phoneNumber&&$.inArray("CallerId",-1!=l[a].features)&&"MainCompanyNumber"!==l[a].usageType&&t.push("<div rcphone="+l[a].phoneNumber+' rcdisplay="'+l[a].phoneNumber+'" onclick="rcTele.selectBrowserCallerid(this)">'+l[a].phoneNumber+"</div>");rc_platform.post("/client-info/sip-provision",{sipInfo:[{transport:"WSS"}]}).then(function(r){var c=r.json().sipFlags.voipFeatureEnabled,l=r.json().sipFlags.outboundCallsEnabled;if(l&&c)(jQuery.browser.chrome&&parseInt(jQuery.browser.version)>29||browser.mozilla&&parseInt(jQuery.browser.version)>47)&&(y.push("Browser"),n.push('<div rcphone="Browser" rcdisplay="Browser" onclick="rcTele.selectRingOutNo(this)">Browser</div>'));else{var a="logtype=logWebphoneStatus&outboundCallsEnabled="+l+"&voipFeatureEnabled="+c+"&rcphone="+encodeURIComponent(CTIAPI.LocalStorage.get("zsrc-login-username"));S.logRCDetails(a)}n.push('<div rcphone="customphone" rcdisplay="Custom Number" onclick="rcTele.selectRingOutNo(this)">Custom Number</div>'),e.length&&e.html(n.join("")),o.length&&o.html(t.join(""))}).catch(function(e){CTIAPI.print("[Error while checking digitalline is enabled or not] "+e.message)})}).catch(function(e){})}).catch(function(e){})},showRCPreference:function(){var e="/support/"+p+"RingCentral.do",o="mode=getRCPreference&"+Object(l.b)()+"="+encodeURIComponent(Object(l.a)());jQuery.ajax({url:e,cache:!1,type:"POST",data:o,success:function(e){var o=e;"Browser"===o?(jQuery("#rcprefdropdown div[rcphone='"+o+"']").trigger("click"),jQuery("#rcbrowsercalleridsdropdown div[rcphone='"+CTIAPI.LocalStorage.get("zsrc-browsercallerid")+"']").trigger("click"),jQuery("#rcbrowsercallerid_div").show()):-1!=$.inArray(o,y)?jQuery("#rcprefdropdown div[rcphone='"+o+"']").trigger("click"):""===o&&""!==v?(jQuery("#rcprefdropdown div[rcphone='"+v+"']").trigger("click"),jQuery("#rcbrowsercalleridsdropdown div[rcphone='"+N+"']").trigger("click")):(jQuery("#rcringoutnumber").html("Custom Number"),jQuery("#rcringoutnumber").attr("value","Custom Number"),jQuery("#rc_custom_phone").val(o),$("#rc_custom_phone_div").show(),jQuery("#rc_custom_phone_errormsg").hide()),jQuery(".zd-tc-bl-freezelayer,#rc_preference_popup").show()}})},updateRCPreference:function(e){var o="/support/"+p+"RingCentral.do",n="mode=updateRCPreference&&outbound_phone="+encodeURIComponent(e)+"&"+Object(l.b)()+"="+encodeURIComponent(Object(l.a)());jQuery.ajax({url:o,cache:!1,type:"POST",data:n,success:function(){CTIAPI.LocalStorage.put("zsrc-login-username",e)}})},saveRCPreference:function(){var e=jQuery("#rcringoutnumber").attr("value");if("Custom Number"===e){var o=$("#rc_custom_phone").val();if(!o.match(/^[\d\-\*\(\)\+\s]+$/))return jQuery("#rc_custom_phone_errormsg").text("Please enter valid custom phone number"),jQuery("#rc_custom_phone_errormsg").show(),!1;e=o}else if("Browser"===e){var n=$("#rcbrowsercallerid").attr("value");void 0===n&&(n=""),CTIAPI.LocalStorage.put("zsrc-browsercallerid",n),rcWebRTC.initWebRTC()}S.updateRCPreference(e),jQuery("#rc_preference_popup").hide()},getRingoutPhone:function(e){var o="/support/"+p+"RingCentral.do",n="mode=getRCPreference&"+Object(l.b)()+"="+encodeURIComponent(Object(l.a)());jQuery.ajax({url:o,cache:!1,type:"POST",data:n,success:function(o){Telephony.global.tempPhoneNumber=o,TeleAssigner.Map.doSuccessCallBackOperations(e)}})},onloadProcess:function(e){S.listionPlatformEvents(),-1!=window.location.host.indexOf("support.zoho.com")?e="https://"+window.location.host+"/support/RingCentralOAuth":-1!=window.location.host.indexOf("supportlab.zoho.com")?e="https://"+window.location.host+"/support/RingCentralOAuth":-1!=window.location.host.indexOf("presupport.zoho.com")?e="https://"+window.location.host+"/support/RingCentralOAuth":-1!=window.location.host.indexOf("presupportlab.zoho.com/")&&(e="https://"+window.location.host+"/support/RingCentralOAuth"),rc_console.log("RINGCENTRAL_SDK_LOG:::::rcredirecturl--\x3e",e),jQuery("#rcredirecturl").val(e)},crmplusRCStatus:function(e){var o=void 0,n=void 0,t=void 0,r=void 0;return e===UserPhoneStatus.WEB_OFFLINE?(o="phonelogin",n="Login",t="phonelogin",r="showDialog"):e===UserPhoneStatus.WEB_ONLINE?(o="Online",n="Online",t=""+e):e===UserPhoneStatus.WEB_BUSY&&(o="Busy",n="DND",t=""+e),{has_access:!0,provider:"ringcentral",isclientsideimpl:!0,currentstatus:{statustype:o,label:n,statuskey:t,method:r}}},crmplusAllRCStatus:function(e){var o=S.crmplusRCStatus(e);return o.otheroption={preferences:{label:"Preferences",key:"phonepreferences",method:"showDialog"},logout:{label:"Logout",key:"",method:"logoutPhoneAgent"}},o.statuslist=[{statustype:"Online",label:"Online",statuskey:"101"},{statustype:"Busy",label:"DND",statuskey:"102"}],o}},O={rc_presenceIntervalId:0,start:function(){0===this.rc_presenceIntervalId&&(this.rc_presenceIntervalId=window.setInterval(this.getPresenceInfo,1e4))},stop:function(){clearInterval(this.rc_presenceIntervalId),this.rc_presenceIntervalId=0},getPresenceInfo:function(){0!==this.rc_presenceIntervalId&&S.checkPresence()}},E={rc_calllogIntervalId:0,start:function(){0===this.rc_calllogIntervalId&&(this.rc_calllogIntervalId=window.setInterval(this.getCalllogInfo,6e4))},stop:function(){clearInterval(this.rc_calllogIntervalId),this.rc_calllogIntervalId=0},getCalllogInfo:function(){0!==this.rc_calllogIntervalId&&S.pollCurrentCallLog()}}},"./src/telephony/providers/ringcentral/ringcentralwebphone.js":function(e,o,n){"use strict";n.r(o),n.d(o,"Methods",function(){return u}),n.d(o,"CtrlBts",function(){return p}),n.d(o,"rcWebRTC",function(){return C});var t=n("./src/createAppStore.js"),r=n("./src/utils/getCSRFCookie.js"),c=n("./deskapp/audio/incoming.ogg"),l=n.n(c),a=n("./deskapp/audio/outgoing.ogg"),s=n.n(a),i=Object(t.a)().getState().routing.paramMap.orgName+"/",u={answer:function(e,o,n){C.acceptCall(o,G_callObj.callrefid),Tracker.track(TConstants.Telephony.LIVECALL_PP.ANSWER_BT)},makeCall:function(e,o,n){rcTele.doRingoutProcess(e,n),TeleAssigner.Map.doSuccessCallBackOperations(o)},preOutboundCallProcess:function(e,o,n){rc_platform.auth().accessTokenValid()?TeleAssigner.Map.doSuccessCallBackOperations(o):showAnimateMessageDiv("Please login to RingCentral","info")},decline:function(e,o,n){C.callEnd(o),Tracker.track(TConstants.Telephony.LIVECALL_PP.DECLINE_BT)},mute:function(e,o,n){C.callMute(o),Tracker.track(TConstants.Telephony.LIVECALL_PP.MUTE_BT)},unmute:function(e,o,n){C.callUnMute(o)},hold:function(e,o,n){C.callHold(o),Tracker.track(TConstants.Telephony.LIVECALL_PP.HOLD_BT)},unhold:function(e,o,n){C.callUnHold(o)},sendDTMF:function(e,o,n){C.sendDigits(o,n)},end:function(e,o,n){C.callEnd(o),Tracker.track(TConstants.Telephony.LIVECALL_PP.CALLBAR_LIVECALL_HUNGUP)},stopcall:function(e,o,n){Telephony.Actions.duringCloseAction("stopcall"),g().then(d).catch(function(e){}),Tracker.track(TConstants.Telephony.LIVECALL_PP.ENDED_BT)},getPhoneNumbers:function(e,o,n){rcTele.getRingoutPhone(o)}},d=function(){G_callObj.callstate="completed",Telephony.Notification.showNotification(G_callObj)},g=function(){return G_callObj.call_state_number=TeleAssigner.Map.assignNumberForCallState("completed"),Telephony.Calls.update()},p={callReceived:function(e){var o=new Telephony.defCtrlBts,n=o.callProceedObj;return Telephony.global.isRCWebRTC&&(n="outbound"===e.calltype?o.callDialedObj:o.callReceivedObj),n},callAnswered:function(e){var o=new Telephony.defCtrlBts,n=o.callProceedAnsObj;return Telephony.global.isRCWebRTC&&((n=o.callAnsweredObj).transferBtn.disabled=!0,n.holdBtn.disabled=!1),n}},C={initWebRTC:function(){rc_platform.post("/client-info/sip-provision",{sipInfo:[{transport:"WSS"}]}).then(function(e){return e.json()}).then(C.register).catch(function(e){rc_console.log("RINGCENTRAL_WEBPHONE_LOG:::::::[Error in loginToRingcentral] "+e.message)})},register:function(e){return sipInfo=e.sipInfo[0]||e.sipInfo,webPhone=new RingCentral.WebPhone(e,{appKey:rc_platform._appKey,audioHelper:{enabled:!0},logLevel:3}),webPhone.userAgent.audioHelper.loadAudio({incoming:l.a,outgoing:s.a}),webPhone.userAgent.on("invite",C.onInvite),webPhone.userAgent.on("connecting",function(){rc_console.log("RINGCENTRAL_WEBPHONE_LOG:::::::WebRTC UA Connecting")}),webPhone.userAgent.on("connected",function(){rc_console.log("RINGCENTRAL_WEBPHONE_LOG:::::::WebRTC UA Connected")}),webPhone.userAgent.on("disconnected",function(){rc_console.log("RINGCENTRAL_WEBPHONE_LOG:::::::WebRTC UA Disconnected")}),webPhone.userAgent.on("registered",function(){rc_console.log("RINGCENTRAL_WEBPHONE_LOG:::::::WebRTC UA Registered")}),webPhone.userAgent.on("unregistered",function(){rc_console.log("RINGCENTRAL_WEBPHONE_LOG:::::::WebRTC UA Unregistered")}),webPhone.userAgent.on("registrationFailed",function(){rc_console.log("RINGCENTRAL_WEBPHONE_LOG:::::::WebRTC UA RegistrationFailed")}),webPhone.userAgent.on("message",function(){rc_console.log("RINGCENTRAL_WEBPHONE_LOG:::::::WebRTC UA Message")}),webPhone},onInvite:function(e){C.acceptOptions={media:{render:{remote:document.getElementById("rcRemoteVideo"),local:document.getElementById("rcLocalVideo")}}},C.session=e},removeSpecialChars:function(e){if(""!==e&&null!=e)for(var o=0;o<"~`!@#$^&%*()=-_[]/{}|:;<>?,. '\"\\".length;o++)e=e.split("~`!@#$^&%*()=-_[]/{}|:;<>?,. '\"\\".charAt(o)).join("");return e},includePlus:function(e){""!==e&&null!=e&&("+"!==(e=C.removeSpecialChars(e)).substring(0,1)&&e.length>10&&(e="+"+e));return e},makeCall:function(e){e=C.includePlus(e),C.session=webPhone.userAgent.invite(e,{media:{render:{remote:document.getElementById("rcRemoteVideo"),local:document.getElementById("rcLocalVideo")}},fromNumber:CTIAPI.LocalStorage.get("zsrc-browsercallerid")}),C.onAccepted(C.session)},acceptCall:function(e){rc_console.log("RINGCENTRAL_WEBPHONE_LOG:::::::Incoming Call Answerd"),C.session.accept(C.acceptOptions).then(function(){C.onAccepted(C.session),TeleAssigner.Map.doSuccessCallBackOperations(e)}).catch(function(e){rc_console.log("RINGCENTRAL_WEBPHONE_LOG:::::::Accept failed",e)})},callEnd:function(e){$("#declineBtn").addClass("zd-tc-action-disabled"),$("#callEndIcon").addClass("zd-tc-action-disabled");var o="/support/"+i+"RingCentral.do",n="mode=doCallOperation&callaction=rcCallEnd&"+Object(r.b)()+"="+encodeURIComponent(Object(r.a)());$.ajax({url:o,cache:!1,type:"POST",data:n,success:function(o){TeleAssigner.Map.doSuccessCallBackOperations(e)}})},rcCallEnd:function(e){rc_console.log("RINGCENTRAL_WEBPHONE_LOG:::::::**********Call End******"),C.session.terminate(),CTIAPI.LocalStorage.has("rc_ringing")||$("#cticallnotification").is(":ui-callnotificationinit")&&$("#cticallnotification").callnotificationinit("clearData")},callMute:function(e){var o="/support/"+i+"RingCentral.do",n="mode=doCallOperation&callaction=rcCallMute&"+Object(r.b)()+"="+encodeURIComponent(Object(r.a)());$.ajax({url:o,cache:!1,type:"POST",data:n,success:function(o){TeleAssigner.Map.doSuccessCallBackOperations(e)}})},rcCallMute:function(e){rc_console.log("RINGCENTRAL_WEBPHONE_LOG:::::::**********Call Mute******"),C.session.mute()},callUnMute:function(e){var o="/support/"+i+"RingCentral.do",n="mode=doCallOperation&callaction=rcCallUnMute&"+Object(r.b)()+"="+encodeURIComponent(Object(r.a)());$.ajax({url:o,cache:!1,type:"POST",data:n,success:function(o){TeleAssigner.Map.doSuccessCallBackOperations(e)}})},rcCallUnMute:function(e){rc_console.log("RINGCENTRAL_WEBPHONE_LOG:::::::**********Call UnMute******"),C.session.unmute()},callHold:function(e){C.session.hold(),TeleAssigner.Map.doSuccessCallBackOperations(e)},callUnHold:function(e){C.session.unhold(),TeleAssigner.Map.doSuccessCallBackOperations(e)},sendDigits:function(e,o){var n=o;rc_console.log("RINGCENTRAL_WEBPHONE_LOG:::::::rc dtmf code====>",n),C.session.dtmf(n),TeleAssigner.Map.doSuccessCallBackOperations(e)},onAnswerSuccessCallBack:function(){G_callObj.callstate="callanswered",Telephony.Notification.showNotification(G_callObj)},onCallEndCallBack:function(){G_callObj.callstate="completed",Telephony.Notification.showNotification(G_callObj)},onAccepted:function(e){e.on("accepted",function(){rc_console.log("RINGCENTRAL_WEBPHONE_LOG:::::::WebRTC Event: Accepted")}),e.on("progress",function(){rc_console.log("RINGCENTRAL_WEBPHONE_LOG:::::::WebRTC Event: Progress")}),e.on("rejected",function(){rc_console.log("RINGCENTRAL_WEBPHONE_LOG:::::::WebRTC Event: Rejected"),close()}),e.on("failed",function(){rc_console.log("RINGCENTRAL_WEBPHONE_LOG:::::::Web RTCnEvent: Failed"),close()}),e.on("terminated",function(){rc_console.log("RINGCENTRAL_WEBPHONE_LOG:::::::WebRTC Event: Terminated"),close()}),e.on("cancel",function(){rc_console.log("RINGCENTRAL_WEBPHONE_LOG:::::::WebRTC Event: Cancel"),close()}),e.on("refer",function(){rc_console.log("RINGCENTRAL_WEBPHONE_LOG:::::::WebRTC Event: Refer"),close()}),e.on("replaced",function(o){rc_console.log("RINGCENTRAL_WEBPHONE_LOG:::::::WebRTC Event: Replaced: old session",e,"has been replaced with",o),close(),C.onAccepted(o)}),e.on("dtmf",function(){rc_console.log("RINGCENTRAL_WEBPHONE_LOG:::::::WebRTC Event: DTMF")}),e.on("muted",function(){rc_console.log("RINGCENTRAL_WEBPHONE_LOG:::::::WebRTC Event: Muted")}),e.on("unmuted",function(){rc_console.log("RINGCENTRAL_WEBPHONE_LOG:::::::WebRTC Event: Unmuted")}),e.on("connecting",function(){rc_console.log("RINGCENTRAL_WEBPHONE_LOG:::::::WebRTC Event: Connecting")}),e.on("bye",function(){rc_console.log("RINGCENTRAL_WEBPHONE_LOG:::::::WebRTC Event: Bye"),close()})}}}}]);