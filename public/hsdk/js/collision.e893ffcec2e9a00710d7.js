(window.deskappJsonp=window.deskappJsonp||[]).push([[69],{"./src/actions/AgentCollisionActions.js":function(e,t,n){"use strict";n.d(t,"g",function(){return c}),n.d(t,"j",function(){return l}),n.d(t,"d",function(){return u}),n.d(t,"e",function(){return d}),n.d(t,"h",function(){return m}),n.d(t,"i",function(){return p}),n.d(t,"a",function(){return f}),n.d(t,"c",function(){return h}),n.d(t,"b",function(){return g}),n.d(t,"f",function(){return b});var a=n("../../../../npm-global/lib/node_modules/@zohodesk/react-cli/node_modules/babel-runtime/core-js/object/assign.js"),o=n.n(a),i=n("./src/utils/RequestAPI.js"),s=n("./src/utils/Common.js"),r=n("../../../../npm-global/lib/node_modules/@zohodesk/react-cli/node_modules/simple-normalizr/es/index.js");function c(e){return{types:Object(s.m)("COLLIDING_USERS"),callAPI:function(t,n){return Object(i.a)("/api/v1/tickets/"+e+"/collision?include=author",!1,{orgId:t.currentOrgId}).get().then(function(e){var t=n(),a=Object(r.b)(e.collisionUsers,Object(r.a)(Object(r.c)("collisionUser",{id:"agentId",mapping:{author:Object(r.c)("agent")}}))),i=e.collisionUsers;return i=h(i=i.filter(function(e){return e.agentId&&e.agentId!=t.myInfo.id})),{collisionData:e=o()({},e,{collisionUsers:i,activeUsersLen:i.length}),entities:{agent:a.entities.agent}}})}}}function l(e,t,n){return{types:Object(s.m)("PUBLISH_USERACTION"),callAPI:function(a){return Object(i.a)("/api/v1/tickets/"+e+"/collision/userAction",!1,{orgId:a.currentOrgId}).post("",{actionType:t,instanceId:n}).then(function(e){return e})}}}function u(e,t){return{types:Object(s.m)("CREATE_CHAT"),callAPI:function(n){return Object(i.a)("/api/v1/tickets/"+e+"/collision/userChatAction",!1,{orgId:n.currentOrgId}).post("",{actionType:"createChat",agentId:t}).then(function(e){return e})}}}function d(e){return{types:Object(s.m)("CREATE_GROUPCHAT"),callAPI:function(t){return Object(i.a)("/api/v1/tickets/"+e+"/collision/userChatAction",!1,{orgId:t.currentOrgId}).post("",{actionType:"createGroupChat"}).then(function(e){return e})}}}function m(e){return{types:Object(s.m)("JOIN_CHAT"),callAPI:function(t){return Object(i.a)("/api/v1/tickets/"+e+"/collision/userChatAction",!1,{orgId:t.currentOrgId}).post("",{actionType:"joinChat"}).then(function(e){return e})}}}function p(e){return{types:Object(s.m)("LEAVE_CHAT"),callAPI:function(t){return Object(i.a)("/api/v1/tickets/"+e+"/collision/userChatAction",!1,{orgId:t.currentOrgId}).post("",{actionType:"leaveChat"}).then(function(e){return e})}}}function f(e,t){return{types:Object(s.m)("ADD_CHATMEMBERS"),callAPI:function(n){return Object(i.a)("/api/v1/tickets/"+e+"/collision/userChatAction",!1,{orgId:n.currentOrgId}).post("",{actionType:"addChatMembers",agentId:t}).then(function(e){return e})}}}function h(e){var t=0,n=0;return e=e.map(function(e,a){var i=Math.floor(a/4);if(n=55*i,0!=a){var s=(a+1)%4-1;t=s<0?165:55*s}return o()(e,{leftPos:t,topPos:n})})}function g(e){return{type:"CLEAR_COLLISION_DATA",data:{ticketId:e}}}function b(){return{types:Object(s.m)("GET_COLLISION_COMPRESS_META"),shouldCallAPI:function(e){return!e.ticketUIStatecollisionCompressMeta},callAPI:function(e){return Object(i.a)("/api/v1/realTime/ticketMeta",!1,{orgId:e.currentOrgId}).get().then(function(e){return e})}}}},"./src/actions/RealTimeActions.js":function(e,t,n){"use strict";n.d(t,"b",function(){return g}),n.d(t,"d",function(){return b}),n.d(t,"o",function(){return I}),n.d(t,"e",function(){return C}),n.d(t,"a",function(){return v}),n.d(t,"p",function(){return E}),n.d(t,"r",function(){return _}),n.d(t,"t",function(){return j}),n.d(t,"s",function(){return N}),n.d(t,"q",function(){return A}),n.d(t,"u",function(){return O}),n.d(t,"k",function(){return y}),n.d(t,"c",function(){return k}),n.d(t,"n",function(){return T}),n.d(t,"m",function(){return z}),n.d(t,"l",function(){return L}),n.d(t,"f",function(){return S}),n.d(t,"h",function(){return U}),n.d(t,"i",function(){return D}),n.d(t,"j",function(){return M}),n.d(t,"g",function(){return R});var a=n("../../../../npm-global/lib/node_modules/@zohodesk/react-cli/node_modules/babel-runtime/core-js/promise.js"),o=n.n(a),i=n("../../../../npm-global/lib/node_modules/@zohodesk/react-cli/node_modules/babel-runtime/helpers/toConsumableArray.js"),s=n.n(i),r=n("../../../../npm-global/lib/node_modules/@zohodesk/react-cli/node_modules/babel-runtime/core-js/object/assign.js"),c=n.n(r),l=n("../../../../npm-global/lib/node_modules/@zohodesk/react-cli/node_modules/babel-runtime/helpers/defineProperty.js"),u=n.n(l),d=n("./src/utils/RequestAPI.js"),m=n("./src/utils/Common.js"),p=n("../../../../npm-global/lib/node_modules/@zohodesk/react-cli/node_modules/simple-normalizr/es/index.js"),f=n("./src/constants/index.js"),h=n("./src/actions/AgentCollisionActions.js");function g(e,t,n){var a=n?"TICKET_ADD_COMMENT":"TICKET_ADD_CONVERSATION";return{types:Object(m.m)(a),callAPI:function(n,a){return Object(d.a)("/api/v1/tickets/"+e+"/comments/"+t+"?include=mentions",!1,{orgId:n.currentOrgId}).get().then(function(t){var n,o="1",i=a().module.ticket[e].commentCount;return(i=parseInt(i))&&i>0&&(o=i+1),{entities:(n={},u()(n,f.R.COMMENT_L,u()({},t.id,t)),u()(n,"ticket",u()({},e,u()({},f.R.COMMENT_L,[t.id]))),n),commentCount:o,result:e}})}}}function b(e,t,n){return function(a,o){var i="0",s=o().module.ticket[e].commentCount;(s=parseInt(s))&&(i=s-1),a({type:n?"TICKET_DELETE_COMMENT_SUCCESS":"TICKET_DELETE_CONVERSATION_SUCCESS",data:{entities:{ticket:u()({},e,u()({},f.R.COMMENT_L,[t]))},commentCount:i,result:e}})}}function I(e,t){return{types:Object(m.m)("UPDATECOMMENT"),callAPI:function(n){return Object(d.a)("/api/v1/tickets/"+e+"/comments/"+t,!1,{orgId:n.currentOrgId}).get().then(function(e){return{entities:{comment:u()({},t,e)}}})}}}function C(){return{types:Object(m.m)("REALTIMEDATA"),callAPI:function(e){return Object(d.a)("/api/v1/temp/realTimeMeta",!1,{orgId:e.currentOrgId}).get().then(function(e){return e})}}}function v(e,t){return{types:Object(m.m)("ADDTHREAD"),callAPI:function(n,a){return Object(d.a)("/api/v1/tickets/"+e+"/threads/"+t,!1,{orgId:n.currentOrgId}).get().then(function(t){var n=a(),o=t.id;if(!Object(m.L)(n,e,o)){var i=u()({},o,t),r=c()({},i,n.module.thread),l=n.module.ticket[e].thread||[],d=n.module.ticket[e].conversationIds||[],p=[o].concat(s()(l)),f=[{id:o,type:"thread"}].concat(s()(d));return{data:t,entities:{thread:r,ticket:u()({},e,{thread:p,conversationIds:f})}}}})}}}function E(e,t){return{types:Object(m.m)("UPDATETHREAD"),callAPI:function(n,a){return Object(d.a)("/api/v1/tickets/"+e+"/threads/"+t,!1,{orgId:n.currentOrgId}).get().then(function(n){var o=a(),i=o.module.ticket[e].conversationIds||[],s=o.module.ticket[e].thread||[];if(i.length){for(var r=0,c=0;c<=i.length;c++)if(i[c].id==t){r=c;break}i.splice(0,0,i.splice(r,1)[0])}else{var l=s.indexOf(t);s.splice(0,0,s.splice(l,1)[0])}return{data:n,entities:{thread:u()({},t,n),ticket:u()({},e,{conversationIds:i,thread:s})}}})}}}function _(e){return function(t,n){var a=e.author,o=e.ticketId,i=Object(p.b)(a,Object(p.c)("agent")),s=n(),r=c()({},s.collidingData[o]),l=r.collisionUsers,u=r.activeUsersLen,d=void 0===u?0:u;l=l?l.filter(function(e){if(e.agentId!=s.myInfo.id&&e.agentId!=a.id)return e}):[],l=[{agentId:a.id,userAction:"viewing"}].concat(l),l=Object(h.c)(l),t({type:"HANDLE_USERIN_SUCCESS",data:{collisionData:c()(r,{collisionUsers:l,ticketId:o,activeUsersLen:d+1,noViewers:!1}),entities:{agent:i.entities.agent}}})}}function j(e,t){return function(n,a){var o=a(),i=c()({},o.collidingData[e]),s={},r=i.collisionUsers,l=i.activeUsersLen;r=r?r.filter(function(e){if(e.agentId!=o.myInfo.id){if(e.agentId!=t)return e;s=e}}):[],s.userAction="isLeft";var u=new Date,d=u.getHours(),m=u.getMinutes(),p=d>=12?"P.M.":"A.M.",f=(d=(d%=12)||12)+":"+(m=m<10?"0"+m:m)+" "+p;s.time=f,r.push(s),r=Object(h.c)(r);var g=1==l;n({type:"HANDLE_USEROUT_SUCCESS",data:{collisionData:c()(i,{collisionUsers:r,ticketId:e,activeUsersLen:l-1,noViewers:g})}})}}function N(e,t){return function(n,a){var o=a(),i=c()({},o.collidingData[e]),s={},r=i.collisionUsers;r=r?r.filter(function(e){if(e.agentId!=o.myInfo.id){if(e.agentId!=t)return e;s=e}}):[],s.userAction="viewing",r=[s].concat(r),r=Object(h.c)(r),n({type:"HANDLE_USERONLINE_SUCCESS",data:{collisionData:c()(i,{collisionUsers:r,ticketId:e})}})}}function A(e,t){return function(n,a){var o=a(),i=c()({},o.collidingData[e]),s={},r=i.collisionUsers;r=r?r.filter(function(e){if(e.agentId!=o.myInfo.id){if(e.agentId!=t)return e;s=e}}):[],s.userAction="idle",r.push(s),r=Object(h.c)(r),n({type:"HANDLE_USERIDLE_SUCCESS",data:{collisionData:c()(i,{collisionUsers:r,ticketId:e})}})}}function O(e,t){return function(n,a){var o=a(),i=c()({},o.collidingData[e]),s={},r=i.collisionUsers;r=r?r.filter(function(e){if(e.agentId!=o.myInfo.id){if(e.agentId!=t)return e;s=e}}):[],s.userAction="replying",s.agentId=t,r=[s].concat(r),r=Object(h.c)(r),n({type:"HANDLE_USERREPLY_SUCCESS",data:{collisionData:c()(i,{collisionUsers:r,ticketId:e})}})}}function y(e){return function(t){t({type:"SET_NOVIWERS_SUCCESS",data:{collisionData:c()({ticketId:e,noViewers:!0,collisionUsers:[],activeUsersLen:0})}})}}function k(e,t){return function(n){n({type:"TICKET_THREAD_DELETE_SUCCESS",data:{ticketId:e,threadId:t}})}}function T(e){return function(t){t({type:"UPDATE_COLLISION_DATA_SUCCESS",data:{collisionData:e}})}}function z(e){var t={};return t.ticketId=e.ticketId,t.chatId=e.chatId,t.chatUsers=e.chatUsers,function(e){e({type:"UPDATE_COLLISION_CHATDATA",data:{chatData:t}})}}function L(e,t){var n=Date.now();return t=c()({},t,{notificationId:n,notificationTime:n}),function(n){n({type:"SHOW_COLLISION_NOTIFICATION",data:{ticketId:e,res:t}})}}function S(e,t){return function(n){n({type:"HIDE_COLLISION_NOTIFICATION",data:{ticketId:e,notificationId:t}})}}function U(e,t){return function(n){n({type:"REMOVE_COLLISION_NOTIFICATION",data:{ticketId:e,notificationId:t}})}}function D(e,t){return function(n){n({type:"RESET_NOTIFICATION_LIST",data:{ticketId:e,notificationList:t}})}}function M(e){return function(t){t({type:"REVOKE_BLUPRINT_SUCCESS",data:{entities:{ticket:u()({},e,{transitionData:""})}}})}}var R=function(){var e={resolve:null,reject:null};return{ob:e,showConfirmBox:function(t){return function(n){return n(function(e){return{type:"SHOW_REALTIMECONFIRM_ALERT",data:e}}(t)),new o.a(function(t,a){e.resolve=function(){n({type:"HIDE_REALTIMECONFIRM_ALERT"}),t()},e.reject=function(){n({type:"HIDE_REALTIMECONFIRM_ALERT"}),a()}})}}}}()},"./src/components/Subtab/collision/CollisionFooter/CollisionFooter.module.css":function(e,t,n){e.exports={footer:"zd-collisionfooter-footer zd9f3b825ff8",offline:"zd-collisionfooter-offline",chatIcon:"zd-collisionfooter-chatIcon",chat:"zd-collisionfooter-chat",chatText:"zd-collisionfooter-chatText zd9f3b825ff8",chatGroupText:"zd-collisionfooter-chatGroupText zd9f3b825ff8",chatStartIcon:"zd-collisionfooter-chatStartIcon",button:"zd-collisionfooter-button zd9f3b825ff8",defaultText:"zd-collisionfooter-defaultText"}},"./src/components/Subtab/collision/CollisionHeader/CollisionHeader.module.css":function(e,t,n){e.exports={title:"zd-collisionheader-title",agents:"zd-collisionheader-agents",agentRight:"zd-collisionheader-agentRight",agentLeft:"zd-collisionheader-agentLeft",countText:"zd-collisionheader-countText",agentCount:"zd-collisionheader-agentCount",avatar:"zd-collisionheader-avatar",agentGroup:"zd-collisionheader-agentGroup",noViewers:"zd-collisionheader-noViewers",deactiveIcon:"zd-collisionheader-deactiveIcon"}},"./src/components/Subtab/collision/CollisionList/CollisionList.module.css":function(e,t,n){e.exports={list:"zd-collisionlist-list",unRead:"zd-collisionlist-unRead",left:"zd-collisionlist-left",message:"zd-collisionlist-message",name:"zd-collisionlist-name",date:"zd-collisionlist-date",changesList:"zd-collisionlist-changesList",success:"zd-collisionlist-success",replied:"zd-collisionlist-replied"}},"./src/components/avatar/AvatarCollision/AvatarCollision.module.css":function(e,t,n){e.exports={container:"zd-avatarcollision-container zd391bc5a95f",on:"zd-avatarcollision-on",off:"zd-avatarcollision-off",idle:"zd-avatarcollision-idle zd-avatarcollision-on",pop:"zd-avatarcollision-pop zde07a357202",icon:"zd-avatarcollision-icon zdddbd5cdbee zd79a1f950cf"}},"./src/components/avatar/AvatarIcon/AvatarIcon.js":function(e,t,n){"use strict";var a=n("../../../../npm-global/lib/node_modules/@zohodesk/react-cli/node_modules/babel-runtime/core-js/object/get-prototype-of.js"),o=n.n(a),i=n("../../../../npm-global/lib/node_modules/@zohodesk/react-cli/node_modules/babel-runtime/helpers/classCallCheck.js"),s=n.n(i),r=n("../../../../npm-global/lib/node_modules/@zohodesk/react-cli/node_modules/babel-runtime/helpers/createClass.js"),c=n.n(r),l=n("../../../../npm-global/lib/node_modules/@zohodesk/react-cli/node_modules/babel-runtime/helpers/possibleConstructorReturn.js"),u=n.n(l),d=n("../../../../npm-global/lib/node_modules/@zohodesk/react-cli/node_modules/babel-runtime/helpers/inherits.js"),m=n.n(d),p=n("../../../../npm-global/lib/node_modules/@zohodesk/react-cli/node_modules/react/index.js"),f=n.n(p),h=n("../../../../npm-global/lib/node_modules/@zohodesk/react-cli/node_modules/prop-types/index.js"),g=n.n(h),b=n("./src/components/avatar/AvatarIcon/AvatarIcon.module.css"),I=n.n(b),C=n("./node_modules/@zohodesk/icons/lib/Icon/index.js"),v=n.n(C),E=function(e){function t(){return s()(this,t),u()(this,(t.__proto__||o()(t)).apply(this,arguments))}return m()(t,e),c()(t,[{key:"render",value:function(){var e=this.props,t=e.name,n=e.size,a=e.iconSize,o=e.iconClass,i=e.onClick,s=e.palette,r=e.dataId,c=e.className,l=e.isIconBold;return f.a.createElement("span",{className:I.a.container+" "+I.a[n]+" "+I.a[s]+" "+(c||""),onClick:i,"data-id":"ZD-chEmail1"===t?"autoId_215":"ZD-chPhone"===t?"autoId_885":r},f.a.createElement(v.a,{name:t,size:a,iconClass:I.a["text_"+o]?I.a["text_"+o]:o||null,isBold:l}))}}]),t}(f.a.Component);t.a=E,E.defaultProps={iconSize:"15",name:"ZD-addAgent",palette:"default",size:"medium",isIconBold:!1},E.propTypes={className:g.a.string,dataId:g.a.string,iconClass:g.a.string,iconSize:g.a.string,isIconBold:g.a.bool,name:g.a.string,onClick:g.a.func,palette:g.a.oneOf(["default","primary","secondary","success","danger"]),size:g.a.string}},"./src/containers/Subtab/Collision/Collision.js":function(e,t,n){"use strict";n.r(t);var a=n("../../../../npm-global/lib/node_modules/@zohodesk/react-cli/node_modules/babel-runtime/helpers/toConsumableArray.js"),o=n.n(a),i=n("../../../../npm-global/lib/node_modules/@zohodesk/react-cli/node_modules/babel-runtime/core-js/object/get-prototype-of.js"),s=n.n(i),r=n("../../../../npm-global/lib/node_modules/@zohodesk/react-cli/node_modules/babel-runtime/helpers/classCallCheck.js"),c=n.n(r),l=n("../../../../npm-global/lib/node_modules/@zohodesk/react-cli/node_modules/babel-runtime/helpers/createClass.js"),u=n.n(l),d=n("../../../../npm-global/lib/node_modules/@zohodesk/react-cli/node_modules/babel-runtime/helpers/possibleConstructorReturn.js"),m=n.n(d),p=n("../../../../npm-global/lib/node_modules/@zohodesk/react-cli/node_modules/babel-runtime/helpers/inherits.js"),f=n.n(p),h=n("../../../../npm-global/lib/node_modules/@zohodesk/react-cli/node_modules/react/index.js"),g=n.n(h),b=n("../../../../npm-global/lib/node_modules/@zohodesk/react-cli/node_modules/prop-types/index.js"),I=n.n(b),C=n("../../../../npm-global/lib/node_modules/@zohodesk/react-cli/node_modules/react-redux/es/index.js"),v=n("./src/actions/AgentCollisionActions.js"),E=n("../components/lib/Card/index.js"),_=n("./src/actions/index.js"),j=n("./src/actions/RealTimeActions.js"),N=n("./src/components/Subtab/collision/CollisionHeader/CollisionHeader.module.css"),A=n.n(N),O=n("./src/components/avatar/AvatarCollision/AvatarCollision.module.css"),y=n.n(O),k=n("../components/lib/Avatar/Avatar.js"),T=n.n(k),z=n("./node_modules/@zohodesk/icons/lib/Icon/index.js"),L=n.n(z),S=function(e){function t(e){return c()(this,t),m()(this,(t.__proto__||s()(t)).call(this,e))}return f()(t,e),u()(t,[{key:"render",value:function(){var e=this.props,t=e.title,n=e.src,a=e.name,o=e.size,i=e.onClick,s=e.needCreateChat,r=e.isLeft,c=e.isIdle;return g.a.createElement("div",{className:y.a.container+" "+(r?y.a.off:c?y.a.idle:y.a.on),onClick:i,"data-id":"collsionPop","data-title":t},g.a.createElement(T.a,{src:n,name:a,size:o,palette:"default",needTitle:!1}),s&&!r&&g.a.createElement("span",{className:y.a.pop,"data-title":t},g.a.createElement("span",{className:y.a.icon},g.a.createElement(L.a,{name:"ZD-livechat3"}))))}}]),t}(g.a.Component),U=S;S.propTypes={isIdle:I.a.bool,isLeft:I.a.bool,name:I.a.string.isRequired,needCreateChat:I.a.bool,onClick:I.a.func,size:I.a.string,src:I.a.string,title:I.a.string},S.defaultProps={needCreateChat:!0,isLeft:!1,isIdle:!1,size:"xmedium"};var D=n("./src/fz-i18n/index.js"),M=n("./src/utils/Common.js"),R=n("../components/lib/Layout/index.js"),x=function(e){function t(){return c()(this,t),m()(this,(t.__proto__||s()(t)).apply(this,arguments))}return f()(t,e),u()(t,[{key:"render",value:function(){var e=this,t=this.props,n=t.moduleMeta,a=t.data,o=t.agents,i=t.createChat,s=t.addChatMembers,r=n.tickets.singularLabel,c=a.collisionUsers,l=a.chatId,u=a.chatUsers,d=a.activeUsersLen,m=a.noViewers,p=55*Math.ceil(c.length/4);return g.a.createElement("div",null,g.a.createElement("div",{className:A.a.title,"data-id":"collisionTitle"},D.h.getI18NValue("support.label.collision.detection.agent.active",[r])),c.length?g.a.createElement(R.Container,{alignBox:"row",align:"vertical",className:A.a.agents,isCover:!1},g.a.createElement(R.Box,{className:A.a.agentLeft},m?g.a.createElement("span",{className:A.a.noViewers,"data-title":D.h.getI18NValue("support.label.no.active.viewers")},g.a.createElement(L.a,{name:"ZD-deactiveUser",iconClass:A.a.deactiveIcon})):g.a.createElement("span",{className:A.a.agentCount,"data-title":D.h.getI18NValue("support.label.active.viewers")},d),g.a.createElement("span",{className:A.a.countText},D.h.getI18NValue("support.label.collision.detection.agent.viewing"))),g.a.createElement(R.Box,{flexible:!0,className:A.a.agentRight},g.a.createElement(R.Container,{alignBox:"row",wrap:"wrap",className:A.a.agentGroup,style:{height:p+"px"}},c.map(function(t,n){var a=t.userAction,c=t.agentId,d=t.time,m=t.leftPos,p=t.topPos,f=o[c],h=f.photoURL,b=f.name||Object(M.e)(f.firstName,f.lastName),I=f.id,C=D.h.getI18NValue("support.label.collision.detection.agent.view",[b]),v=!1,E=!1;"replying"==a?C=D.h.getI18NValue("support.label.collision.detection.agent.reply.txt",[b]):"idle"==a?(C=D.h.getI18NValue("support.label.collision.detection.agent.idle",[b,d]),E=!0):"isLeft"==a&&(v=!0,C=D.h.getI18NValue("support.label.collision.detection.agent.left",[b,r,d]));var _=null,j=!0;return l?(j=!1,u&&-1==u.indexOf(""+I)&&(_=s.bind(e,[I]),j=!0)):(_=i.bind(e,[I]),j=!0),g.a.createElement("div",{className:A.a.avatar,key:c,style:{left:m+"px",top:p+"px"}},g.a.createElement(U,{src:h,name:b,title:C,isLeft:v,isIdle:E,onClick:_,needCreateChat:j}))})))):null)}}]),t}(g.a.Component),P=x;x.propTypes={addChatMembers:I.a.func,agents:I.a.object,createChat:I.a.func,data:I.a.object,moduleMeta:I.a.object};var V=n("./src/components/Subtab/collision/CollisionFooter/CollisionFooter.module.css"),w=n.n(V),H=function(e){function t(){return c()(this,t),m()(this,(t.__proto__||s()(t)).apply(this,arguments))}return f()(t,e),u()(t,[{key:"render",value:function(){var e=this.props,t=e.data,n=e.currentUserId,a=e.joinChat,o=e.leaveChat,i=e.createGroupChat,s=t.chatId,r=t.collisionUsers,c=t.chatUsers,l=c&&-1!=c.indexOf(n);return!s&&r.length>2?g.a.createElement("div",{className:w.a.footer},g.a.createElement("div",{className:w.a.offline},g.a.createElement("span",{className:w.a.chatStartIcon,onClick:i},g.a.createElement(L.a,{name:"ZD-chChat"})),g.a.createElement("span",{className:w.a.chatGroupText,onClick:i},D.h.getI18NValue("support.label.collision.groupchat.start")))):s?g.a.createElement("div",{className:w.a.footer},g.a.createElement(R.Container,{alignBox:"row",align:"vertical",isCover:!1},g.a.createElement(R.Box,{className:w.a.chatIcon},g.a.createElement(L.a,{name:"ZD-chChat"})),g.a.createElement(R.Box,{className:w.a.chat,flexible:!0},g.a.createElement("span",{className:w.a.chatText+" "+(!l&&w.a.defaultText),onClick:l?a:null,"data-id":"ActiveChat"},D.h.getI18NValue("support.label.collision.groupchat.active"))),g.a.createElement("span",{className:w.a.button,onClick:l?o:a,"data-id":"JoinOrLeaveChat"},l?D.h.getI18NValue("support.label.collision.groupchat.leave"):D.h.getI18NValue("support.label.collision.groupchat.join")))):null}}]),t}(g.a.Component),B=H;H.propTypes={createGroupChat:I.a.func,currentUserId:I.a.string,data:I.a.object,joinChat:I.a.func,leaveChat:I.a.func};var G=n("./src/components/Subtab/collision/CollisionList/CollisionList.module.css"),F=n.n(G),W=n("./src/components/avatar/AvatarIcon/AvatarIcon.js"),Z=function(e){function t(){return c()(this,t),m()(this,(t.__proto__||s()(t)).apply(this,arguments))}return f()(t,e),u()(t,[{key:"render",value:function(){var e=this.props,t=e.name,n=e.image,a=e.message,o=e.time,i=e.modifiedData,s=void 0===i?[]:i,r=e.action,c=e.isRead,l=s.map(function(e,t){var n=e.fieldName,a=e.fieldValue;return g.a.createElement("li",{key:t},n," :",g.a.createElement("span",null," ",a))});return g.a.createElement(R.Container,{alignBox:"row",className:F.a.list+" "+(c?"":F.a.unRead),isCover:!1},g.a.createElement(R.Box,{className:F.a.left},"replied"==r?g.a.createElement(W.a,{iconSize:"19",name:"ZD-kbessentialsendmessage",palette:"success",size:"xmedium",isIconBold:!0,iconClass:F.a.replied}):g.a.createElement(T.a,{name:t,size:"xmedium",src:n})),g.a.createElement(R.Box,{flexible:!0},a&&g.a.createElement("p",{className:F.a.message+" "+("replied"==r&&F.a.success)},g.a.createElement("span",{className:F.a.name},t)," ",a),s.length?g.a.createElement("ul",{className:F.a.changesList},l):null,g.a.createElement("p",{className:F.a.date},o)))}}]),t}(g.a.Component),K=Z;Z.propTypes={action:I.a.string,image:I.a.string,isRead:I.a.bool,message:I.a.string,modifiedData:I.a.array,name:I.a.string,time:I.a.string};var q=n("./src/utils/bind.js"),J=function(e){function t(e){c()(this,t);var n=m()(this,(t.__proto__||s()(t)).call(this,e));n.state={currentTime:null},n.interval=0;return q.a.apply(n,["createGroupChat","createChat","joinChat","leaveChat","addChatMembers","hideAllPopupNotification"]),n}return f()(t,e),u()(t,[{key:"componentDidMount",value:function(){var e=this;this._mount=!0,0==this.interval&&(this.interval=setInterval(function(){e._mount&&e.setState({currentTime:Date.now()})},6e4)),this.hideAllPopupNotification()}},{key:"componentDidUpdate",value:function(e){e.collisionNotificationList.length!=this.props.collisionNotificationList.length&&this.hideAllPopupNotification()}},{key:"componentWillUnmount",value:function(){clearInterval(this.interval);var e=this.props,t=e.id,n=e.collisionNotificationList,a=e.resetNotificationList;n.length&&a(t,n.map(function(e){return e.isRead||(e.isRead=!0),e}))}},{key:"hideAllPopupNotification",value:function(){var e=this.props,t=e.id,n=e.collisionNotificationList,a=e.resetNotificationList;n.length&&a(t,n.map(function(e){return e.showNotification&&(e.showNotification=!1),e}))}},{key:"createGroupChat",value:function(){var e=this.props,t=e.id,n=e.createGroupChat;n(t)}},{key:"createChat",value:function(e,t){var n=this.props,a=n.id,o=n.createChat,i=n.showMessage;o(a,e).then(function(){jQuery.isFunction(WebMessanger.isChatPaused)&&WebMessanger.isChatPaused()&&i({type:"success",message:D.h.getI18NValue("support.label.collision.chat.pause")})}).catch(function(e){i({type:"alert",message:D.h.getI18NValue("support.label.collision.chat.create.error")})})}},{key:"joinChat",value:function(){var e=this.props,t=e.id,n=e.joinChat,a=e.showMessage;n(t).then(function(){jQuery.isFunction(WebMessanger.isChatPaused)&&WebMessanger.isChatPaused()&&a({type:"success",message:D.h.getI18NValue("support.label.collision.chat.pause")})}).catch(function(){a({type:"alert",message:D.h.getI18NValue("support.label.collision.chat.join.error")})})}},{key:"leaveChat",value:function(){var e=this.props,t=e.id,n=e.leaveChat,a=e.showMessage;n(t).then(function(){jQuery.isFunction(WebMessanger.isChatPaused)&&WebMessanger.isChatPaused()&&a({type:"success",message:D.h.getI18NValue("support.label.collision.chat.pause")})}).catch(function(){a({type:"alert",message:D.h.getI18NValue("support.label.collision.chat.leave.error")})})}},{key:"addChatMembers",value:function(e){var t=this.props,n=t.id,a=t.addChatMembers;a(n,e)}},{key:"render",value:function(){var e=this.props,t=e.data,n=e.agents,a=e.moduleMeta,i=e.collisionNotificationList,s=e.currentUserId,r=[].concat(o()(i)).reverse();return g.a.createElement(E.Card,null,g.a.createElement(E.CardHeader,null,g.a.createElement(P,{data:t,moduleMeta:a,agents:n,createChat:this.createChat,addChatMembers:this.addChatMembers})),g.a.createElement(E.CardContent,null,r.map(function(e,t){var a=e.actionBy,o=e.message,i=e.mode,s=e.notificationTime,r=e.action,c=void 0===r?"":r,l=e.modifiedData,u=e.isRead,d=e.noNeedShowinList,m=n[a];if(m&&"userIn"!=i&&"userOut"!=i&&!d){var p="",f=Date.now()-s,h=Math.floor(f/864e5),b=Math.floor(f%864e5/36e5),I=Math.floor(f%864e5%36e5/6e4);Math.floor(f%864e5%36e5%6e4/1e3);return h>0&&(p+=h>1?h+" "+D.h.getI18NValue("days")+" ":h+" "+D.h.getI18NValue("day")+" "),b>0&&(p+=b>1?b+" "+D.h.getI18NValue("hours")+" ":b+" "+D.h.getI18NValue("hour")+" "),I>0?p+=I>1?I+" "+D.h.getI18NValue("minutes")+" ":I+" "+D.h.getI18NValue("minute")+" ":p=D.h.getI18NValue("label.few")+" "+D.h.getI18NValue("seconds")+" ",""!=p&&(p+=" "+D.h.getI18NValue("ago")),g.a.createElement(K,{image:m.photoURL,name:m.name||Object(M.e)(m.firstName,m.lastName),message:o,time:p,action:c,modifiedData:l,isRead:u})}return null})),g.a.createElement(E.CardFooter,null,g.a.createElement(B,{joinChat:this.joinChat,leaveChat:this.leaveChat,createGroupChat:this.createGroupChat,data:t,currentUserId:s})))}}]),t}(h.Component);J.propTypes={addChatMembers:I.a.func,agents:I.a.object,collisionNotificationList:I.a.array,createChat:I.a.func,createGroupChat:I.a.func,currentUserId:I.a.string,data:I.a.object,id:I.a.string,joinChat:I.a.func,leaveChat:I.a.func,moduleMeta:I.a.object,resetNotificationList:I.a.func,showMessage:I.a.func,usersLength:I.a.number};t.default=Object(C.connect)(function(e,t){return{agents:e.module.agent,moduleMeta:e.moduleMeta,currentUserId:e.myInfo.id}},{createGroupChat:v.e,createChat:v.d,showMessage:_.Q,resetNotificationList:j.i,joinChat:v.h,leaveChat:v.i,addChatMembers:v.a})(J)},"./src/utils/bind.js":function(e,t,n){"use strict";function a(){for(var e=this,t=arguments.length,n=Array(t),a=0;a<t;a++)n[a]=arguments[a];n.forEach(function(t){e[t]=e[t].bind(e)})}n.d(t,"a",function(){return a})}}]);