(window.deskappJsonp=window.deskappJsonp||[]).push([[92],{"./src/telephony/providers/amazonconnect/lilynotifier.js":function(e,t,n){"use strict";n.r(t),n.d(t,"lilyAgentBasicDetails",function(){return I}),n.d(t,"Methods",function(){return C}),n.d(t,"CtrlBts",function(){return S}),n.d(t,"lilyIntegMethods",function(){return A});var l=n("../../../../npm-global/lib/node_modules/@zohodesk/react-cli/node_modules/babel-runtime/helpers/typeof.js"),i=n.n(l),o=n("../../../../npm-global/lib/node_modules/@zohodesk/react-cli/node_modules/babel-runtime/core-js/json/stringify.js"),a=n.n(o),s=n("../../../../npm-global/lib/node_modules/@zohodesk/react-cli/node_modules/babel-runtime/core-js/math/trunc.js"),c=n.n(s),r=n("./src/createAppStore.js"),u=n("./src/utils/getCSRFCookie.js"),d=n("./src/telephony/constants/index.js").a.UPDATE_LILY_STATUS,g=Object(r.a)(),p=g.getState().routing.paramMap.orgName+"/",y={},m={},f={},h={},b={},I={statusKeyFnsMap:[]};f.click2callnumber="";var C={answer:function(e,t,n){lilyInteg.acceptCall(t,G_callObj.callrefid),Tracker.track(TConstants.Telephony.LIVECALL_PP.ANSWER_BT)},makeCall:function(e,t,n){lilyInteg.makeCall(n),TeleAssigner.Map.doSuccessCallBackOperations(t)},preOutboundCallProcess:function(e,t,n){"routable"===y.getStatus().type&&lilyInteg.isOutgoingEnabled?TeleAssigner.Map.doSuccessCallBackOperations(t):lilyInteg.isOutgoingEnabled?(console.log("Going to set Lily status Online and initiate the call"),lilyInteg.setOnlineAndCall(t)):showAnimateMessageDiv("You are not allowed to do outbound calls with Lily. Please contact your Amazon Connect Administrator.","info")},decline:function(e,t,n){lilyInteg.callEnd(t),Tracker.track(TConstants.Telephony.LIVECALL_PP.DECLINE_BT)},hold:function(e,t,n){lilyInteg.callHold(t),Tracker.track(TConstants.Telephony.LIVECALL_PP.HOLD_BT)},unhold:function(e,t,n){lilyInteg.callUnHold(t)},sendDTMF:function(e,t,n){lilyInteg.sendDigits(t,n)},end:function(e,t,n){lilyInteg.callEnd(t),Tracker.track(TConstants.Telephony.LIVECALL_PP.CALLBAR_LIVECALL_HUNGUP)},stopcall:function(e,t,n){Telephony.Actions.duringCloseAction("stopcall"),_().then(v).catch(function(e){}),Tracker.track(TConstants.Telephony.LIVECALL_PP.ENDED_BT)},closePopup:function(e,t,n){Telephony.Actions.doCallEndSaveAction(function(){Telephony.Actions.duringCloseAction("close")}),Tracker.track(TConstants.Telephony.LIVECALL_PP.CLOSE),lilyInteg.setOnline()},getPhoneNumbers:function(e,t,n){lilyInteg.getRingoutPhone(t)}},v=function(){G_callObj.callstate="completed",Telephony.Notification.showNotification(G_callObj)},_=function(){return G_callObj.call_state_number=TeleAssigner.Map.assignNumberForCallState("completed"),Telephony.Calls.update()},S={callReceived:function(e){var t=new Telephony.defCtrlBts,n=t.callProceedObj;return(e.onclient||"outbound"===e.calltype)&&(n="outbound"===e.calltype?t.callDialedObj:t.callReceivedObj),n},callAnswered:function(e){var t=new Telephony.defCtrlBts,n=t.callProceedAnsObj;return e.onclient&&((n=t.callAnsweredObj).transferBtn.disabled=!0,n.muteBtn.disabled=!0,n.holdBtn.disabled=!1,n.dialPad.disabled=!1),n}},A={isLilyConnected:!1,isLoggedIn:!1,isOutgoingEnabled:!1,isSoftphoneEnabled:!1,initializeLily:function(e){""!==g.getState().telephony.telephonyProperties.amazonInstance&&(lilyInteg.initializeCCP(),lilyInteg.initializeAgent(function(t){return e&&e(t)}))},initializeCCP:function(){var e=document.getElementById("lily_ccp_container"),t=g.getState().telephony.telephonyProperties.lilyCCPUrl;connect.core.initCCP(e,{ccpUrl:t,softphone:{allowFramedSoftphone:!0,disableRingtone:!1}})},initializeAgent:function(e){connect.agent(function(t){console.debug("---------agent---------",t.getStatus().type),y=t,lilyInteg.loginSuccessProcess(),y.onRefresh(function(e){console.debug("---------agent onRefresh---------"),g.getState().telephony.channelStatus.status!==y.getStatus().name&&g.dispatch({type:""+d,data:y.getStatus()}),lilyInteg.updateStatusOnAgentRefresh(y.getStatus());y.getStatus().type,y.getStatus().name;for(var t=y.getPermissions(),n=0;n<t.length;n++)"outboundCall"===t[n]&&(lilyInteg.isOutgoingEnabled=!0);y.getConfiguration().softphoneAutoAccept;lilyInteg.isSoftphoneEnabled=y.getConfiguration().softphoneEnabled}),connect.contact(function(e){console.debug("---------contact---------",e.getStatus().type),"connecting"===(m=e).getStatus().type&&lilyInteg.getCallDetails("ringing"),"FailedConnectCustomer"===y.getStatus().name&&lilyInteg.getCallDetails("completed"),m.onRefresh(function(){console.debug("---------contact onRefresh---------",m.getStatus().type)}),m.onConnected(function(){console.debug("---------contact onConnected---------",m.getStatus().type),lilyInteg.getCallDetails("callconnected")}),m.onEnded(function(){console.debug("---------contact onEnded---------",m.getStatus().type),lilyInteg.getCallDetails("completed")})}),e&&e({status:y.getStatus(),options:y.getAgentStates()})})},showLoginPopup:function(){setTimeout(function(){if(!CTIAPI.LocalStorage.has("lily_login_later_enabled")&&!lilyInteg.isLoggedIn&&(jQuery(".zd-tc-bl-freezelayer,#lilyLoginContainer").show(),"undefined"!=typeof CrmPlusImpl&&CrmPlusImpl.isLoadedInCrmplus())){CrmPlusImpl.trigger("pushNotification",[{type:"message",subtype:"showphoneloginpopup"}])}},1e4)},loginSuccessProcess:function(){lilyInteg.isLoggedIn=!0,T.stop(),void 0!==P&&P.close(),jQuery(".zd-tc-bl-freezelayer,#lilyLoginContainer").hide(),CTIAPI.LocalStorage.remove("lily_login_later_enabled"),lilyInteg.constructAgentStatus()},getCallDetails:function(e){for(var t=m.isInbound()?"inbound":"outbound",n=0;n<m.getConnections().length;n++)"inbound"==m.getConnections()[n].getType()||"outbound"==m.getConnections()[n].getType()?b=m.getConnections()[n]:h=m.getConnections()[n];var l=b.getAddress().phoneNumber;null!==l&&""!==l&&-1===l.indexOf("sip:")||(l=f.click2callnumber);var i=y.getRoutingProfile().defaultOutboundQueue.name;if(f.callstate=m.getStatus().type,f.calltype=t,f.callrefid=m.getContactId(),f.custnumber=ZTwilio.Utils.removeSpecialChars(l),f.ctinumber=i,console.debug("contact status ==>",m.getStatus().type),console.debug("contact direction ==>",t),console.debug("contact callrefid ==>",m.getContactId()),console.debug("contact connections ==>",m.getConnections()),console.debug("contact custnumber ==>",l),console.debug("contact ctinumber ==>",i),"ringing"===e){console.debug("contact ringing time ===>",m.getStatus().timestamp);var o=new Date(m.getStatus().timestamp);f.createdtime=o.getTime(),lilyInteg.notificationHandler("ringing")}else if("callconnected"===e){console.debug("contact connected time ===>",m.getStatus().timestamp);o=new Date(m.getStatus().timestamp);f.connectedTime=o.getTime(),void 0!==f.createdtime&&""!==f.createdtime||(f.createdtime=f.connectedTime),lilyInteg.notificationHandler("callconnected")}else if("completed"===e){console.debug("contact completed time ===>",m.getStatus().timestamp);o=new Date(m.getStatus().timestamp);if(f.completedTime=o.getTime(),f.callduration=0,""!==f.connectedTime&&void 0!==f.connectedTime){var a=f.completedTime-f.connectedTime;a/=1e3,a=c()(a),f.callduration=a}console.debug("contact callduration ====>",f.callduration),lilyInteg.notificationHandler("completed")}},notificationHandler:function(e){if(f.callstate=e,"ringing"!==f.callstate||CTIAPI.LocalStorage.has("lily_ringing"))if("callconnected"!==f.callstate||CTIAPI.LocalStorage.has("lily_connected")){if("completed"===f.callstate&&!CTIAPI.LocalStorage.has("lily_completed")){CTIAPI.LocalStorage.put("lily_completed","true");t="/support/"+p+"AwsLily.do",n="mode=lilyNotificationHandler&callstate="+f.callstate+"&custnumber="+encodeURIComponent(f.custnumber)+"&ctinumber="+f.ctinumber+"&calltype="+f.calltype+"&callrefid="+f.callrefid+"&callduration="+f.callduration+"&createdtime="+f.createdtime+"&isOvertheBrowser="+lilyInteg.isSoftphoneEnabled+"&"+Object(u.b)()+"="+encodeURIComponent(Object(u.a)());console.debug("[lily-notification] Dataparams on call completed =>"+a()(n)),$.ajax({url:t,cache:!1,type:"POST",data:n,success:function(e){lilyInteg.resetLilyCallDetails()}}),Telephony.Notification.hideTelephonyLoading()}}else if(CTIAPI.LocalStorage.put("lily_connected","true"),$("#cticallnotification").is(":ui-callnotificationinit")){"Browser"===CTIAPI.LocalStorage.get("lily-ctinumber")&&(lilyInteg.isLilyConnected=!0,Telephony.CallBack.answerSuccess());var t="/support/"+p+"AwsLily.do",n="mode=lilyNotificationHandler&callstate="+f.callstate+"&custnumber="+encodeURIComponent(f.custnumber)+"&ctinumber="+f.ctinumber+"&calltype="+f.calltype+"&callrefid="+f.callrefid+"&createdtime="+f.createdtime+"&isOvertheBrowser="+lilyInteg.isSoftphoneEnabled+"&"+Object(u.b)()+"="+encodeURIComponent(Object(u.a)());console.debug("[lily-notification] Dataparams on callconnected =>"+a()(n)),$.ajax({url:t,cache:!1,type:"POST",data:n,success:function(e){}})}else{if(CTIAPI.LocalStorage.has("lily_ringing"))return console.debug("As ringing is already notified in other tab don't need to do anything"),!1;CTIAPI.LocalStorage.put("lily_ringing","true"),console.debug("-----As ringing notification not happened we are handling it in callconnected state-----");t="/support/"+p+"AwsLily.do",n="mode=lilyNotificationHandler&callstate=ringing&isStartTimer=true&custnumber="+encodeURIComponent(f.custnumber)+"&ctinumber="+f.ctinumber+"&calltype="+f.calltype+"&callrefid="+f.callrefid+"&createdtime="+f.createdtime+"&isOvertheBrowser="+lilyInteg.isSoftphoneEnabled+"&"+Object(u.b)()+"="+encodeURIComponent(Object(u.a)());console.debug("[lily-notification] Dataparams on callconnected =>"+a()(n)),$.ajax({url:t,cache:!1,type:"POST",data:n,success:function(e){}})}else{if(""===f.custnumber)return console.log("outgoing made from Lily softphone, in this case lily is not notifying the custnumber. we will handle this in connected state"),!1;CTIAPI.LocalStorage.put("lily_ringing","true");var t="/support/"+p+"AwsLily.do",n="mode=lilyNotificationHandler&callstate="+f.callstate+"&custnumber="+encodeURIComponent(f.custnumber)+"&ctinumber="+f.ctinumber+"&calltype="+f.calltype+"&callrefid="+f.callrefid+"&createdtime="+f.createdtime+"&isOvertheBrowser="+lilyInteg.isSoftphoneEnabled+"&"+Object(u.b)()+"="+encodeURIComponent(Object(u.a)());"outbound"===f.calltype&&""!==f.entityid&&void 0!==f.entityid&&(n+="&entityid="+encodeURIComponent(f.entityid)),console.debug("[lily-notification] Dataparams on ringing =>"+a()(n)),$.ajax({url:t,cache:!1,type:"POST",data:n,success:function(e){}})}}};lilyInteg.removeSpecialChars=function(e){if(""!==e&&null!=e)for(var t=0;t<"~`!@#$^&%*()=-_[]/{}|:;<>?,. '\"\\".length;t++)e=e.split("~`!@#$^&%*()=-_[]/{}|:;<>?,. '\"\\".charAt(t)).join("");return e},lilyInteg.includePlus=function(e){""!==e&&null!=e&&("+"!==(e=lilyInteg.removeSpecialChars(e)).substring(0,1)&&e.length>10&&(e="+"+e));return e},lilyInteg.makeCall=function(e){var t=lilyInteg.includePlus(e.zsPhoneNumber);f.click2callnumber=t;var n=connect.Address.byPhoneNumber(t),l=y.getRoutingProfile().defaultOutboundQueue.queueId;y.connect(n,{queueId:l,success:function(e){console.log("ringout initiated successfully ===>",e)},failure:function(){console.log("errMsg ===>",errMsg)}})},lilyInteg.acceptCall=function(e){console.log("Incoming Call Answerd"),m.accept({success:function(){TeleAssigner.Map.doSuccessCallBackOperations(e)},failure:function(){}})},lilyInteg.callEnd=function(e){$("#declineBtn").addClass("zd-tc-action-disabled"),h.destroy(),CTIAPI.LocalStorage.has("lily_ringing")||$("#cticallnotification").is(":ui-callnotificationinit")&&$("#cticallnotification").callnotificationinit("clearData"),TeleAssigner.Map.doSuccessCallBackOperations(e)},lilyInteg.callHold=function(e){b.hold(),TeleAssigner.Map.doSuccessCallBackOperations(e)},lilyInteg.callUnHold=function(e){b.resume({success:function(){jQuery("div#callMuteBtn").addClass("zd-tc-action-disabled opctdot2")},failure:function(){}}),TeleAssigner.Map.doSuccessCallBackOperations(e)},lilyInteg.sendDigits=function(e,t){var n=t;console.log("lily dtmf code",n),b.sendDigits(n,{success:function(){},failure:function(){}}),TeleAssigner.Map.doSuccessCallBackOperations(e)},lilyInteg.getRingoutPhone=function(e){Telephony.global.tempPhoneNumber=y.getRoutingProfile().defaultOutboundQueue.name,TeleAssigner.Map.doSuccessCallBackOperations(e)},lilyInteg.enableLily=function(){freezeBackground(),jQuery(".zd-tc-freezeLayer").show();var e=jQuery("input[name='isCreateMissedCallTicket']").is(":checked"),t=jQuery("#createMissedCallFor").val(),n="/support/"+p+"AwsLily.do",l="mode=enableLily&ctiname=awslily&isCreateMissedCallTicket="+e+"&createMissedCallFor="+t+"&"+Object(u.b)()+"="+encodeURIComponent(Object(u.a)());jQuery.ajax({url:n,cache:!1,type:"POST",data:l,success:function(e){if("success"===e&&(window.location.hash="#setup/channels/phone",window.location.reload(),"undefined"!=typeof CrmPlusImpl&&CrmPlusImpl.isLoadedInCrmplus())){CrmPlusImpl.trigger("updatePhoneAgentStatus",[{provider:"awslily",has_access:!0,isclientsideimpl:!0,currentstatus:{label:"Login",method:"showDialog",statuskey:"phonelogin",statustype:"phonelogin"}}])}}})},lilyInteg.disableLily=function(){var e="/support/"+p+"AwsLily.do",t="mode=disableLily&ctiname=awslily&"+Object(u.b)()+"="+encodeURIComponent(Object(u.a)());jQuery.ajax({url:e,cache:!1,type:"POST",data:t,success:function(e){"success"===e&&("undefined"!=typeof CrmPlusImpl&&CrmPlusImpl.isLoadedInCrmplus()&&CrmPlusImpl.trigger("removeAgentStatus",["phone"]),setTimeout(function(){window.location.reload()},2e3))}})},lilyInteg.saveAmazonMissedTicketCreation=function(){if("awslily"===g.getState().telephony.telephonyProviderName){var e=jQuery("input[name='isCreateMissedCallTicket']").is(":checked"),t=jQuery("#createMissedCallFor").val(),n="/support/"+p+"AwsLily.do",l="mode=saveAmazonMissedTicketCreation&isCreateMissedCallTicket="+e+"&createMissedCallFor="+t+"&"+Object(u.b)()+"="+encodeURIComponent(Object(u.a)());jQuery.ajax({url:n,cache:!1,type:"POST",data:l,success:function(e){showAnimateMessageDiv(getI18NValue("crm.massupdate.updatedsuccesfully"))}})}},lilyInteg.constructAgentStatus=function(){for(var e=y.getAgentStates(),t="",n="",l=0;l<e.length;l++){var i=e[l].type,o=e[l].name;e[l].agentStatusId;"routable"===i?(t+='<div class="zd-tc-deptlist zd-tc-breakAll zd-tc-h20" onclick=\'lilyInteg.setStatus('+a()(e[l])+');hidestatuspopup("#lily_status_popup")\'>',t+='<span class="icon-phone zd-tc-mt1 zd-tc-zd-tc-onlineclr zd-tc-f13 zd-tc-fleft"></span>',t+='<div class="zd-tc-fleft zd-tc-ml10 zd-tc-content-dotted">'+o+"</div>",t+="</div>"):"offline"===i?(t+='<div class="zd-tc-deptlist zd-tc-breakAll zd-tc-h20" onclick=\'lilyInteg.setStatus('+a()(e[l])+');hidestatuspopup("#lily_status_popup")\'>',t+='<span class="icon-phone zd-tc-mt1 zd-tc-f13 zd-tc-fleft"></span>',t+='<div class="zd-tc-fleft zd-tc-ml10 zd-tc-content-dotted">'+o+"</div>",t+="</div>"):(n+='<div class="zd-tc-deptlist zd-tc-breakAll zd-tc-h20" onclick=\'lilyInteg.setStatus('+a()(e[l])+');hidestatuspopup("#lily_status_popup")\'>',n+='<span class="icon-phone zd-tc-zd-tc-offlineclr zd-tc-mt1 zd-tc-f13 zd-tc-fleft"></span>',n+='<div class="zd-tc-fleft zd-tc-ml10 zd-tc-content-dotted">'+o+"</div>",n+="</div>")}n+='<div class="zd-tc-deptlist zd-tc-breakAll zd-tc-posrel zd-tc-h20" onclick=\'lilyInteg.showPreference();hidestatuspopup("#lily_status_popup")\'>',n+='<span class="icon-d-pref zd-tc-mt1 zd-tc-f13 zd-tc-clrb4 zd-tc-fleft"></span>',n+='<div class="zd-tc-fleft zd-tc-ml10 zd-tc-content-dotted">'+getI18NValue("support.setup.label.community_preference")+"</div>",t+=n+="</div>",jQuery("#lily_status_container").html(t),jQuery("#lily_login_icon").hide(),jQuery("#lily_status_popup_container").show(),lilyInteg.crmplusNotifyAllAmazonStatus()},lilyInteg.setOnlineAndCall=function(e){for(var t=y.getAgentStates(),n={},l=0;l<t.length;l++){if("routable"===t[l].type){n=t[l];break}}y.setStatus(n,{success:function(){TeleAssigner.Map.doSuccessCallBackOperations(e)},failure:function(){}})},lilyInteg.setOnline=function(e){for(var t=y.getAgentStates(),n={},l=0;l<t.length;l++){if("routable"===t[l].type){n=t[l],lilyInteg.setStatus(n),e&&e({state:"success",phoneStatus:t[l]});break}}},lilyInteg.setStatus=function(e,t){y.setStatus(e,{success:function(){"routable"===e.type?$("#lily_status_image").addClass("zd-tc-onlineclr").removeClass("zd-tc-offlineclr").text("Online").attr("title",e.name):$("#lily_status_image").addClass("zd-tc-offlineclr").removeClass("zd-tc-onlineclr").text(e.name).attr("title",e.name),t&&t({state:"success",phoneStatus:e.name})},failure:function(){t&&t({state:"failure",phoneStatus:e.name})}})},lilyInteg.updateStatusOnAgentRefresh=function(e){for(var t=y.getAgentStates(),n=!1,l=0;l<t.length;l++)e.name===t[l].name&&(n=!0);var i="Busy";if("routable"===e.type?($("#lily_status_image").addClass("zd-tc-onlineclr").removeClass("zd-tc-offlineclr").text("Online").attr("title",e.name),i="Online"):n?($("#lily_status_image").addClass("zd-tc-offlineclr").removeClass("zd-tc-onlineclr").text(e.name).attr("title",e.name),i="Offline"):("MissedCallAgent"===e.name&&"completed"===f.callstate&&(setTimeout(function(){Agent.logout.togglepopup("show")},1e3),setTimeout(function(){$("#lily_status_image").trigger("mouseover")},2e3)),$("#lily_status_image").addClass("zd-tc-offlineclr").removeClass("zd-tc-onlineclr").attr("title",e.name)),"undefined"!=typeof CrmPlusImpl&&CrmPlusImpl.isLoadedInCrmplus()){var o=lilyInteg.crmplusAmazonNotifyObject(i,e.name);CrmPlusImpl.trigger("updatePhoneAgentStatus",[o])}},lilyInteg.showPreference=function(){var e=jQuery("#lilyprefdropdown"),t=[],n=y.getConfiguration().extension,l=y.getConfiguration().softphoneEnabled;jQuery("#lily_custom_phone").val(n),[].push("Browser"),t.push('<div lilyphone="Browser" lilydisplay="Browser" onclick="lilyInteg.selectRingOutNo(this)">Browser</div>'),t.push('<div lilyphone="customphone" lilydisplay="Custom Number" onclick="lilyInteg.selectRingOutNo(this)">Custom Number</div>'),e.length&&e.html(t.join("")),l?(jQuery("#lilyringoutnumber").html("Browser"),jQuery("#lilyringoutnumber").attr("value","Browser"),jQuery("#lily_custom_phone_div").hide()):(jQuery("#lilyringoutnumber").html("Custom Number"),jQuery("#lilyringoutnumber").attr("value","Custom Number"),$("#lily_custom_phone_div").show(),jQuery("#lily_custom_phone_errormsg").hide()),jQuery(".zd-tc-bl-freezelayer,#lily_preference_popup").show()},lilyInteg.selectRingOutNo=function(e){var t=jQuery(e).attr("lilyphone"),n=jQuery(e).attr("lilydisplay");"customphone"===t?(jQuery("#lily_custom_phone_div").show(),jQuery("#lilyringoutnumber").html(n),jQuery("#lilyringoutnumber").attr("value","Custom Number")):(jQuery("#lilyringoutnumber").html(n),jQuery("#lilyringoutnumber").attr("value",t),jQuery("#lily_custom_phone_div").hide(),jQuery("#lily_custom_phone_errormsg").hide()),setTimeout(function(){jQuery("#lilyprefdropdown").addClass("hide")},100)},lilyInteg.savePreference=function(){var e=jQuery("#lilyringoutnumber").attr("value");if("Custom Number"===e){if(!$("#lily_custom_phone").val().match(/^[\d\-\(\)\+\s]+$/))return jQuery("#lily_custom_phone_errormsg").text("Please enter valid custom phone number"),jQuery("#lily_custom_phone_errormsg").show(),!1}var t=y.getConfiguration();"Browser"===e?t.softphoneEnabled=!0:(t.softphoneEnabled=!1,t.extension=$("#lily_custom_phone").val()),y.setConfiguration(t,{success:function(){lilyInteg.isSoftphoneEnabled=t.softphoneEnabled,console.log("prefernce updated successfully!")},failure:function(){}}),jQuery("#lily_preference_popup").hide()},lilyInteg.loginLaterProcess=function(){jQuery(".zd-tc-bl-freezelayer,#lilyLoginContainer").hide(),jQuery("#lilyLoginLaterPopup").show(),CTIAPI.LocalStorage.put("lily_login_later_enabled","true")};var P=void 0;lilyInteg.loginToLily=function(e){var t=jQuery("#amazonInstance").val(),n=g.getState().telephony.telephonyProperties.amazonInstance;if(""!==t)if(t!==n)lilyInteg.updateInstanceAlias(t);else{var l=g.getState().telephony.telephonyProperties.lilyCCPUrl;g.dispatch({type:"TELEPHONY_PROPERTIES_UPDATE",data:{telephonyProperties:{lilyCCPUrl:l}}}),P=window.open(l,"lilyLoginWindow","location=0,status=0,width=800,height=600,left=300,top=100"),jQuery(".zd-tc-bl-freezelayer,#lilyLoginContainer,#lilyLoginBtn").hide(),lilyInteg.initializeLily(function(t){return e&&e(t)}),T.start()}},lilyInteg.updateInstanceAlias=function(e){var t="/support/"+p+"AwsLily.do",n="mode=updateInstanceAlias&instanceAlias="+e+"&"+Object(u.b)()+"="+encodeURIComponent(Object(u.a)());jQuery.ajax({url:t,cache:!1,type:"POST",data:n,success:function(t){g.getState().telephony.telephonyProperties.amazonInstance=e,lilyInteg.loginToLily()}})},lilyInteg.getInstanceAlias=function(){var e="/support/"+p+"AwsLily.do",t="mode=getInstanceAlias&"+Object(u.b)()+"="+encodeURIComponent(Object(u.a)());jQuery.ajax({url:e,cache:!1,type:"POST",data:t,success:function(e){console.log("instanceAliase --\x3e",e)}})};var T={lily_lilyIntervalId:0,start:function(){console.log("starting timer...."),0===this.lily_lilyIntervalId&&(this.lily_lilyIntervalId=window.setInterval(this.initializeCCP,1e4))},stop:function(){console.log("stoping timer...."),clearInterval(this.lily_lilyIntervalId),this.lily_lilyIntervalId=0},initializeCCP:function(){0!==this.lily_lilyIntervalId&&($("#lily_ccp_container").children("iframe").remove(),lilyInteg.initializeCCP(),setTimeout(function(){console.log("goining to initialize agent"),lilyInteg.initializeAgent()},5e3))}};lilyInteg.resetLilyCallDetails=function(){console.debug("going to reset last call details"),(f={}).click2callnumber="",f.entityid="",CTIAPI.LocalStorage.remove("lily_ringing"),CTIAPI.LocalStorage.remove("lily_connected"),CTIAPI.LocalStorage.remove("lily_completed")},lilyInteg.crmplusNotifyAllAmazonStatus=function(){if("undefined"!=typeof CrmPlusImpl&&CrmPlusImpl.isLoadedInCrmplus()){for(var e=y.getAgentStates(),t=e.length,n=[],l=0;l<t;l++){var i="StatusKey_"+l,o="routable"==(s=e[l]).type?"Online":"Offline",a=lilyInteg.crmplusAmazonNotifyObject(o,s.name,i,"",!0);n.push(a),I.statusKeyFnsMap[i]=s}o="Offline";var s=y.getStatus(),c=!1;for(l=0;l<t;l++)s.name==e[l].name&&(c=!0);o="routable"==s.type?"Online":1==c?"Offline":"Busy";var r=lilyInteg.crmplusAmazonNotifyObject(o,s.name);r.otheroption={preferences:{label:"Preferences",key:"phonepreferences",method:"showDialog"}},r.statuslist=n;var u=[r];CrmPlusImpl.trigger("setPhoneAgentStatus",u)}},lilyInteg.crmplusAmazonNotifyObject=function(e,t,n,l,o){var a={statustype:e,label:t};return void 0!==n&&""!==n&&(a.statuskey=n),void 0!==l&&""!==l&&(a.method=l),void 0!==(void 0===o?"undefined":i()(o))&&!0===o?a:{servicename:"support",type:"phone",subtype:"updatestatus",has_access:!0,provider:"awslily",currentstatus:a}}}}]);