(window.deskappJsonp=window.deskappJsonp||[]).push([[180],{"./src/telephony/providers/zti/ZTI.js":function(e,t,l){"use strict";l.r(t),l.d(t,"hideFreezeMessage",function(){return c}),l.d(t,"ZTI",function(){return r}),l.d(t,"Methods",function(){return d}),l.d(t,"CtrlBts",function(){return s}),l.d(t,"mailsetCenter",function(){return p}),l.d(t,"splitDialCode",function(){return u}),l.d(t,"changeDialCodeShape",function(){return f}),l.d(t,"checkActive",function(){return T});var a=l("./src/createAppStore.js"),n=l("./src/telephony/utils/index.js"),o=Object(a.a)(),i=o.getState().routing.paramMap.orgName+"/";function c(){$("#ztipopup").hide(),Object(n.removeFreezeLayer)()}var r={handleCustomMessage:function(e){var t=e.action;if("sendCallDuration"===t){var l=Telephony.Utils.getTimeInSeconds();G_callObj.callRefId!==e.callRefId&&Telephony.Queue.checkCallIsAlreadyPresent(e)&&(l=0),0===l&&(e.oprtype="closenotify",e.isMissedCall=!0,e.callduration=0),Telephony.Notification.showNotification(e),Telephony.ZTI.Actions.sendCallDuration(l,e.callrefid,e.ctiname,e.caseId)}else"showNotification"===t?(Telephony.ZTI.assignObjectValues(e),Telephony.Notification.showNotification(e)):"startCallTimer"===t?Telephony.ZTI.Operations.startCallTimer(e):"stopCallTimer"===t?Telephony.ZTI.Operations.stopCallTimer(e):"handleMissedCall"===t?Telephony.Operations.closeNotify(e):"updateCallDuration"===t&&Telephony.ZTI.Operations.updateCallDuration(e)},assignObjectValues:function(e){null==e.callstate||"callconnected"!==e.callstate&&"callanswered"!==e.callstate||(e.callstate="proceedanswer"),Telephony.Notification.assignObjectValues(e)},Actions:{sendCallDuration:function(e,t,l,a){var n="/support/"+i+"ZTICallAction.do",o={event:"updateCallDuration",duration:e,callRefId:t,ctiName:l,caseId:a,portalName:i.substring(0,i.indexOf("/"))};Telephony.Utils.setCSRFParam(o),$.ajax({type:"POST",cache:!1,url:n,data:o,success:function(e){}})},startCallTimer:function(e){var t="/support/"+i+"ZTICallAction.do",l={event:"startCallTimer",callRefId:e,portalName:i.substring(0,i.indexOf("/"))};Telephony.Utils.setCSRFParam(l),Telephony.global.callAns=!0,$.ajax({type:"POST",cache:!1,url:t,data:l,success:function(e){Telephony.global.callAns=!0}})},stopCallTimer:function(e){var t=Telephony.Utils.getTimeInSeconds(),l="/support/"+i+"ZTICallAction.do",a={event:"stopCallTimer",callRefId:e,duration:t,portalName:i.substring(0,i.indexOf("/"))};Telephony.Utils.setCSRFParam(a),Telephony.global.callEnd=!0,$.ajax({type:"POST",cache:!1,url:l,data:a,success:function(e){Telephony.global.callEnd=!0}})},makeCall:function(e,t,l){if(""!=e.trim()){var a="",c="",r="/support/"+i+"ZTIMakeCall.do";if(o.getState().routing.urls.detailView.match>0&&"contacts"==o.getState().moduleMapper[o.getState().routing.paramMap.moduleName]&&(a=o.getState().routing.paramMap.moduleId),o.getState().routing.urls.detailView.match>0&&"tickets"==o.getState().moduleMapper[o.getState().routing.paramMap.moduleName]&&(c=o.getState().routing.paramMap.moduleId),c="1"===l?"":c,"makecall"===t)var d=null!=$("#dialCode")?$("#dialCode").val():$("#dialLabel").html(),s={event:"makeCall",callnow:"callnow",contactid:a,tonumber:e.replace(/[^0-9]+/g,""),dialCode:d.replace(/[^0-9]+/g,""),ticketId:c};else s={event:"makeCall",contactid:a,tonumber:e.replace(/[^0-9]+/g,""),ticketId:c,callnow:""};var b=$("div[id^='taskQVPopup_']");if(null!=b){var f=b.find("#taskSecId").val();null!=f&&""!=f&&(s.activityid=f)}Telephony.Utils.setCSRFParam(s),jQuery.ajax({url:r,cache:!1,type:"POST",data:s,success:function(e){if("401"===e)displayPopup("alert",getI18NValue("crm.zti.error.notauthendication"));else if(null!==e&&-1!==e.indexOf("SELECT:::")){Object(n.freezeBackground)(),e=e.split("SELECT:::")[1],Object(n.getObj)("freezeContiner").innerHTML=e;var t=Object(n.getObj)("ztipopup");t.style.top="381",t.style.position="fixed",t.style.zIndex="30",t.style.display="block",p("ztipopup"),window.onLoad=u("0")}},failure:function(){displayPopup("alert","There was an error with the connection")}})}else displayPopup("alert","caller cannot be empty")}},Operations:{startCallTimer:function(e){e.callRefId!==G_callObj.callrefid&&e.callrefid!==G_callObj.callrefid||(Telephony.global.callAns?(Telephony.ZTI.assignObjectValues(e),Telephony.Notification.showNotification(e)):Telephony.Notification.destroyNotification())},stopCallTimer:function(e){e.callRefId!==G_callObj.callrefid&&e.callrefid!==G_callObj.callrefid||(Telephony.global.callEnd?(Telephony.ZTI.assignObjectValues(e),Telephony.Notification.showNotification(e)):Telephony.Notification.destroyNotification())},updateCallDuration:function(e){e.callRefId!==G_callObj.callrefid&&e.callrefid!==G_callObj.callrefid||(G_callObj.callduration=e.callduration,Telephony.Utils.setTimeSentByProviderInPopup(e.callduration))}}},d={preOutboundCallProcess:function(e,t,l){var a=$(e);Telephony.ZTI.Actions.makeCall(a.attr("phonenum"),"",a.attr("callformdp"))},proceed:function(e,t,l){Telephony.ZTI.Actions.startCallTimer(G_callObj.callrefid)},stopcall:function(e,t,l){Telephony.ZTI.Actions.stopCallTimer(G_callObj.callrefid)},getPhoneNumbers:function(e,t,l){Telephony.global.tempPhoneNumber="No_callerid",TeleAssigner.Map.doSuccessCallBackOperations(t)}},s={callReceived:function(e){return(new Telephony.defCtrlBts).callProceedObj},callAnswered:function(e){return(new Telephony.defCtrlBts).callProceedAnsObj}};function p(e){var t=0,l=0,a=document.getElementById(e);document.all?(t=document.body.offsetWidth+document.body.scrollLeft,l=document.body.offsetHeight+jQuery(window).scrollTop()):(t=window.innerWidth+document.body.scrollLeft,l=window.innerHeight+jQuery(window).scrollTop()),a.style.display="block";var n=a.offsetWidth,o=a.offsetHeight,i=t/2+document.body.scrollLeft-n/2,c=l/2+jQuery(window).scrollTop()/2-o/2;a.style.left=parseInt(i)+"px",a.style.top=parseInt(c)+"px"}function u(e){var t=Object(n.getObj)("dialCodeBackUp")[e].value.split(";");Object(n.getObj)("groupName").selectedIndex=e,Object(n.getObj)("pbxType").selectedIndex=e;var l=document.createElement("SELECT");l.setAttribute("id","dialCode"),l.setAttribute("name","dialCode"),l.className="txtfieldnew zd-tc-w80",l.onclick=function(){b()},Object(n.getObj)("dialLabel").appendChild(l);var a=t,o=t;if(t.length>1){Object(n.getObj)("dialLabel").innerHTML="";for(var i=0;i<a.length;i++){if(0==i){(c=document.createElement("option")).text="-None-",c.value="";try{l.add(c,null)}catch(e){l.add(c)}}(c=document.createElement("option")).text=f(a[i]),c.value=f(o[i]);try{l.add(c,null)}catch(e){l.add(c)}}Object(n.getObj)("dialLabel").appendChild(l),Object(n.getObj)("pbxLabel").innerHTML=Object(n.getObj)("pbxType").value}else if(1==t.length&&""!=t&&"NOPREFIX"!=t){Object(n.getObj)("dialLabel").innerHTML="";for(i=0;i<a.length;i++){if(0==i){(c=document.createElement("option")).text="-None-",c.value="";try{l.add(c,null)}catch(e){l.add(c)}}var c;(c=document.createElement("option")).text=f(a[i]),c.value=f(o[i]);try{l.add(c,null)}catch(e){l.add(c)}}Object(n.getObj)("dialLabel").appendChild(l),Object(n.getObj)("pbxLabel").innerHTML=Object(n.getObj)("pbxType").value}else Object(n.getObj)("dialLabel").innerHTML="",Object(n.getObj)("dialLabel").innerHTML=Object(n.getObj)("dialCodeBackUp")[e].value,Object(n.getObj)("pbxLabel").innerHTML=Object(n.getObj)("pbxType").value;b()}function b(){Object(n.getObj)("phoneLabel").innerHTML="";var e=function(e,t){var l=new RegExp(e).exec(t);if(null!=l)return l[1];return""}("\\((.*?)\\)",null!=Object(n.getObj)("dialCode")&&null!=Object(n.getObj)("dialCode")?Object(n.getObj)("dialCode").value:Object(n.getObj)("dialLabel").innerHTML);e=""!=e?e+"-":"",Object(n.getObj)("phoneLabel").innerHTML=e+Object(n.getObj)("tonumber").value}function f(e){var t,l="";return t=e.split(":"),null!=e&&(l=t[0],""!=t[1]&&null!=t[1]&&(l+="("+t[1]+")")),l}function T(){var e=contextName+"/"+i+"ZTIConfig.do?event=hasAnyMoreAdminRole";jQuery.ajax({url:e,cache:!1,type:"GET",contentType:"text/html;charset=UTF-8",data:"",success:function(e){if("YES"==e)displayPopup("alert",getI18NValue("support.telephony.on_premise.create.phoneBridge.alert"));else{var t=jQuery("#pbxType").val();ajaxNew("/support/"+i+"ZTIConfig.do","event=showGroup&isAjax=true&loadType=innerBody&currentProvider="+t)}}})}}}]);