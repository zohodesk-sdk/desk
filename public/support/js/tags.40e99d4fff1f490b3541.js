(window.deskappJsonp=window.deskappJsonp||[]).push([[119],{1200:function(e,a,t){"use strict";var n=t(12),s=t.n(n),o=t(9),r=t.n(o),l=t(10),c=t.n(l),i=t(13),h=t.n(i),u=t(14),g=t.n(u),d=t(0),m=t.n(d),f=t(1),p=t.n(f),_=t(1201),T=t.n(_),S=t(64),v=t.n(S),y=t(72),x=t.n(y),C=t(16),b=t(6),E=t(8),R=function(e){function a(e){r()(this,a);var t=h()(this,(a.__proto__||s()(a)).call(this,e));return t.getScrollContainerRef=t.getScrollContainerRef.bind(t),t.getSelectedItemRef=t.getSelectedItemRef.bind(t),t.onScroll=t.onScroll.bind(t),t.isFetching=!1,t}return g()(a,e),c()(a,[{key:"getScrollContainerRef",value:function(e){this.scrollContainerRef=e}},{key:"getSelectedItemRef",value:function(e){this.selectItemRef=e}},{key:"componentDidUpdate",value:function(){var e=this.props.selectSearchIndex,a=this.scrollContainerRef,t=this.selectItemRef;if(t&&a){var n=t.offsetTop-a.scrollTop,s=t.offsetHeight,o=a.offsetHeight;(n<0||s+n>o)&&(a.scrollTop=0==e?0:a.scrollTop+n)}}},{key:"onScroll",value:function(e){var a=this;if(this.props.fetchData&&!this.isFetching){var t=e.currentTarget;t.scrollHeight<=t.scrollTop+t.offsetHeight&&(this.isFetching=!0,this.props.fetchData().then(function(){a.isFetching=!1},function(){a.isFetching=!1}))}}},{key:"render",value:function(){var e=this,a=this.props,t=a.data,n=a.orgName,s=(a.selectEmail,a.type),o=a.selectSearchIndex,r=(a.addTag,a.needFixed),l=a.needAvatar,c=a.onSelect;return m.a.createElement(x.a,{onScroll:this.onScroll,isArrow:!1,boxPosition:"bottomCenter",isActive:!0,className:""+(r?T.a.resetDropbox:"")},m.a.createElement("div",{ref:this.getScrollContainerRef,className:l?T.a.agentSearch:T.a.tagsSearch},t.length?t.map(function(a,t){a.id;var r=a.name,i=a.email,h=a.isNew,u=a.firstName,g=a.lastName,d=a.photoURL,f=a.newLabel,p=l&&d?d+"?portalname="+n:null;l&&Object(b.g)(u,g);return r=l?Object(b.e)(u,g):r,m.a.createElement(C.Container,{alignBox:"row",align:"vertical",className:T.a.asItem+" "+(o==t?T.a.selectIem:""),onMouseDown:function(){c(a,s)},eleRef:t==o?e.getSelectedItemRef:null,key:t},l?m.a.createElement(C.Box,{className:T.a.imgCont},m.a.createElement(v.a,{src:p,name:r,size:"medium"})):null,m.a.createElement(C.Box,{flexible:!0},m.a.createElement("div",{className:T.a.ashead},h?m.a.createElement("span",{className:T.a.newTag},f):null,r),i?m.a.createElement("div",{className:T.a.asemail},i):null))}):m.a.createElement("div",{className:T.a.searchDiv},E.f.getI18NValue("support.label.searching"))))}}]),a}(m.a.Component);a.a=R,R.propTypes={addTag:p.a.func,data:p.a.array,fetchData:p.a.oneOfType([p.a.func,p.a.bool]),isPopupOpen:p.a.bool,needAvatar:p.a.bool,orgName:p.a.string,placeholder:p.a.string,removeClose:p.a.func,selectEmail:p.a.func,selectSearchIndex:p.a.number,theme:p.a.string,togglePopup:p.a.func,type:p.a.string},R.defaultProps={data:[],needAvatar:!0}},1201:function(e,a,t){e.exports={searchDrop:"SearchResults-module__searchDrop",resetDropbox:"SearchResults-module__resetDropbox",agentSearch:"SearchResults-module__agentSearch SearchResults-module__searchDrop",tagsSearch:"SearchResults-module__tagsSearch SearchResults-module__searchDrop",asItem:"SearchResults-module__asItem",ashead:"SearchResults-module__ashead common-module__semibold common-module__ftsmooth common-module__dotted common-module__oflow common-module__ellipsis",newTag:"SearchResults-module__newTag",selectIem:"SearchResults-module__selectIem",searchDiv:"SearchResults-module__searchDiv",imgCont:"SearchResults-module__imgCont",asemail:"SearchResults-module__asemail common-module__dotted common-module__oflow common-module__ellipsis",defaultSize:"SearchResults-module__defaultSize",black:"SearchResults-module__black",white:"SearchResults-module__white",iconCustom:"SearchResults-module__iconCustom"}},1617:function(e,a,t){e.exports={tagCont:"Tags-module__tagCont",inputDiv:"Tags-module__inputDiv",shortcutKey:"Tags-module__shortcutKey",close:"Tags-module__close",closeText:"Tags-module__closeText",tagDiv:"Tags-module__tagDiv",tag:"Tags-module__tag",errorMsg:"Tags-module__errorMsg",errorContent:"Tags-module__errorContent"}},1618:function(e,a,t){e.exports={tagCont:"Tags-module__tagCont",inputDiv:"Tags-module__inputDiv",shortcutKey:"Tags-module__shortcutKey",close:"Tags-module__close",closeText:"Tags-module__closeText",tagDiv:"Tags-module__tagDiv",tag:"Tags-module__tag",errorMsg:"Tags-module__errorMsg",errorContent:"Tags-module__errorContent"}},677:function(e,a,t){"use strict";t.r(a);var n=t(12),s=t.n(n),o=t(9),r=t.n(o),l=t(10),c=t.n(l),i=t(13),h=t.n(i),u=t(14),g=t.n(u),d=t(0),m=t.n(d),f=t(1),p=t.n(f),_=t(26),T=(t(1617),t(1618)),S=t.n(T),v=t(16),y=t(30),x=t(8),C=t(246),b=t.n(C),E=t(99),R=t.n(E),I=t(1200),D=function(e){function a(){return r()(this,a),h()(this,(a.__proto__||s()(a)).apply(this,arguments))}return g()(a,e),c()(a,[{key:"render",value:function(){var e=this,a=this.props,t=a.handleKeyUp,n=a.handleChange,s=a.closeSearch,o=a.searchList,r=a.selectSearchIndex,l=a.addTag,c=a.searchTags,i=a.noMoreData,h=a.showErrorMsg,u=a.tagsList,g=a.toggleTags,d=a.deleteTag,f=a.name,p=a.isReadOnly;return m.a.createElement(v.Container,{alignBox:"row",className:S.a.tagCont},m.a.createElement(v.Box,{flexible:!0},m.a.createElement(v.Container,{alignBox:"column"},m.a.createElement(v.Box,{className:S.a.topDiv},m.a.createElement("div",{className:S.a.inputDiv},m.a.createElement(R.a,{placeHolder:x.f.getI18NValue("support.request.create.tag"),value:f,onKeyUp:t,onChange:n,onBlur:s,maxLength:50,isReadOnly:p}),o.length?m.a.createElement("span",null,m.a.createElement(I.a,{data:o,selectSearchIndex:r,needAvatar:!1,onSelect:l,fetchData:!i&&c})):null),p?null:m.a.createElement("div",{className:S.a.shortcutKey},"Shift + T"),h?m.a.createElement("div",{className:S.a.errorMsg},m.a.createElement(y.CommonFontIcon,{name:"information57",size:"16",color:"danger"}),m.a.createElement("div",{className:S.a.errorContent},x.f.getI18NValue("support.request.maxium.tag"))):null),m.a.createElement(v.Box,{className:S.a.tagDiv},u.length?u.map(function(a,t){var n=a.name,s=a.tagType;return m.a.createElement("span",{className:S.a.tag,key:t},m.a.createElement(b.a,{text:n,onRemove:d.bind(e,n),closeTitle:x.f.getI18NValue("support.label.delete.tag"),palette:"SYSTEM"==s?"primary":"default",onSelectTag:function(){},disabled:p}))}):null))),m.a.createElement(v.Box,{className:S.a.close,onClick:g},m.a.createElement(y.GettingstartedFontIcon,{name:"closee",size:"20"}),m.a.createElement("span",{className:S.a.closeText},x.f.getI18NValue("crm.label.close"))))}}]),a}(m.a.Component),N=D;D.propTypes={addTag:p.a.func,closeSearch:p.a.func,deleteTag:p.a.func,handleChange:p.a.func,handleKeyUp:p.a.func,isReadOnly:p.a.bool,name:p.a.string,noMoreData:p.a.bool,searchList:p.a.array,searchTags:p.a.func,selectSearchIndex:p.a.string,showErrorMsg:p.a.func,tagsList:p.a.array,toggleTags:p.a.func};var L=t(164),w=function(e){function a(e){r()(this,a);var t=h()(this,(a.__proto__||s()(a)).call(this,e));return t.state={tagsList:[],searchList:[],name:"",from:1,limit:10,selectSearchIndex:-1,noMoreData:!0,showErrorMsg:!1},t.handleChange=t.handleChange.bind(t),t.handleKeyUp=t.handleKeyUp.bind(t),t.addTag=t.addTag.bind(t),t.deleteTag=t.deleteTag.bind(t),t.searchTags=t.searchTags.bind(t),t.closeSearch=t.closeSearch.bind(t),t}return g()(a,e),c()(a,[{key:"componentDidMount",value:function(){var e=this,a=this.props,t=a.id;(0,a.getTicketTags)(t).then(function(a){var t=a.data;e.setState({tagsList:t.res.tags})})}},{key:"handleChange",value:function(e){this.setState({name:e}),e.length>2?this.searchTags(e,1):this.closeSearch()}},{key:"handleKeyUp",value:function(e){var a=e.keyCode,t=this.state,n=t.name,s=t.searchList,o=t.selectSearchIndex;13==a?o>-1?this.addTag(s[o]):n.length>=3&&-1==n.indexOf(",")&&this.addTag({name:n}):188==a?n.length>3&&(n=n.substring(0,n.indexOf(",")),this.addTag({name:n})):40==a?this.setState(function(e){var a=e.selectSearchIndex==s.length-1?0:e.selectSearchIndex+1;return{selectSearchIndex:a,name:s[a].name}}):38==a?this.setState(function(e){var a=e.selectSearchIndex<=0?s.length-1:e.selectSearchIndex-1;return{selectSearchIndex:a,name:s[a].name}}):27==a&&this.closeSearch()}},{key:"addTag",value:function(e){var a=this,t=e.name;if(10==this.state.tagsList.length)this.setState({showErrorMsg:!0});else{var n=this.props,s=n.id;(0,n.associateTag)(s,t).then(function(e){var t=a.state.tagsList;t=t.concat(e.data.data),a.closeSearch(),a.setState({name:"",tagsList:t})})}}},{key:"deleteTag",value:function(e){var a=this,t=this.props,n=t.id;(0,t.dissociateTag)(n,e).then(function(){var t=a.state.tagsList.filter(function(a){return a.name!=e});a.setState({tagsList:t,showErrorMsg:!1})})}},{key:"searchTags",value:function(e,a){var t=this,n=this.props.getTagSearchList,s=this.state,o=s.limit,r=s.searchName,l=s.tagsList;return a=1===a?a:this.state.from+o,n(e=e||r,a,o).then(function(n){var s=n.data.res.data,r=s.length<o,c=[];(s=1==a?s:t.state.searchList.concat(s)).length&&(c=s.filter(function(e){return!l.filter(function(a){return a.name==e.name}).length}));var i=c.find(function(a){return a.name===e});i=i||l.find(function(a){return a.name===e}),s.length&&c.length&&i||c.push({name:e,isNew:!0,newLabel:x.f.getI18NValue("support.label.newtag")}),t.setState({searchList:c,noMoreData:r,searchName:e})})}},{key:"closeSearch",value:function(){this.setState({searchList:[],selectSearchIndex:-1})}},{key:"render",value:function(){var e=this.props,a=e.toggleTags,t=e.isReadOnly,n=this.state,s=n.tagsList,o=n.name,r=n.searchList,l=n.selectSearchIndex,c=n.noMoreData,i=n.showErrorMsg;return m.a.createElement(N,{name:o,handleKeyUp:this.handleKeyUp,handleChange:this.handleChange,closeSearch:this.closeSearch,searchList:r,selectSearchIndex:l,addTag:this.addTag,searchTags:this.searchTags,noMoreData:c,showErrorMsg:i,tagsList:s,toggleTags:a,deleteTag:this.deleteTag,isReadOnly:t})}}]),a}(d.Component);w.propTypes={getTagSearchList:p.a.func,getTicketTags:p.a.func,id:p.a.string,isReadOnly:p.a.bool,toggleTags:p.a.func};a.default=Object(_.connect)(function(e){return{}},{getTicketTags:L.g,associateTag:L.a,dissociateTag:L.b,getTagSearchList:L.e})(w)}}]);