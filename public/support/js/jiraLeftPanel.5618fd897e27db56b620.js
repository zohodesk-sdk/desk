(window.deskappJsonp=window.deskappJsonp||[]).push([[89],{1228:function(e,t,n){"use strict";var a=n(12),r=n.n(a),o=n(9),s=n.n(o),i=n(10),u=n.n(i),l=n(13),c=n.n(l),d=n(14),p=n.n(d),m=n(0),f=n.n(m),g=n(1),I=n.n(g),_=n(1246),j=n.n(_),h=n(151),k=n.n(h),O=n(30),C=function(e){function t(){return s()(this,t),c()(this,(t.__proto__||r()(t)).apply(this,arguments))}return p()(t,e),u()(t,[{key:"render",value:function(){var e=this.props,t=e.text,n=(e.status,e.children),a=e.id,r=e.isLocked,o=e.lockedMsg;return f.a.createElement("div",{className:""+(r?j.a.locked:"")},f.a.createElement("div",{className:""+(r?j.a.inline:"")},f.a.createElement(k.a,{size:"small",text:t,type:"title",id:a,clipped:!0})),o?f.a.createElement("span",{className:j.a.lockIcon,"data-title":o},f.a.createElement(O.CommunityFontIcon,{name:"locked",size:"14",isBold:!0})):null,f.a.createElement("div",{className:j.a.ticketForm},n))}}]),t}(f.a.Component);t.a=C,C.defaultProps={status:"data",text:"Label",isLocked:!1,lockedMsg:""},C.propTypes={children:I.a.node,id:I.a.string,isLocked:I.a.bool,lockedMsg:I.a.string,status:I.a.oneOfType([I.a.string,I.a.bool]),text:I.a.string}},1246:function(e,t,n){e.exports={ticketForm:"FieldItem-module__ticketForm common-module__semibold common-module__ftsmooth",locked:"FieldItem-module__locked",inline:"FieldItem-module__inline",lockIcon:"FieldItem-module__lockIcon"}},1323:function(e,t,n){"use strict";n.d(t,"d",function(){return l}),n.d(t,"b",function(){return c}),n.d(t,"c",function(){return d}),n.d(t,"i",function(){return p}),n.d(t,"f",function(){return m}),n.d(t,"e",function(){return f}),n.d(t,"g",function(){return g}),n.d(t,"h",function(){return I}),n.d(t,"a",function(){return _});var a=n(2),r=n.n(a),o=n(5),s=n.n(o),i=n(15),u=n(6);function l(e){return{types:Object(u.m)("GET_JIRABUG_INFO"),callAPI:function(t){return Object(i.a)("/api/v1/tickets/"+e+"/jiraIssue",!1,{orgId:t.currentOrgId}).get().then(function(t){return{entities:{ticket:s()({},e,{jiraBugInfo:t.issueInfo?t:null})},result:[]}})}}}function c(e,t){return{types:Object(u.m)("CREATE_JIRA"),callAPI:function(n,a){return Object(i.a)("/api/v1/tickets/"+e+"/jiraIssue",!1,{orgId:n.currentOrgId}).post("",t).then(function(e){return e})}}}function d(e){return{types:Object(u.m)("DELINK_JIRABUG"),callAPI:function(t,n){return Object(i.a)("/api/v1/tickets/"+e+"/jiraIssue",!1,{orgId:t.currentOrgId}).del().then(function(t){return{entities:{ticket:s()({},e,{jiraBugInfo:null})},result:[]}})}}}function p(e,t){var n=t.transitionId,a=t.issueStatus,o=t.issueStatusCategory;return{types:Object(u.m)("OPEN_OR_CLOSE_BUG"),callAPI:function(t,u){return Object(i.a)("/api/v1/tickets/"+e+"/jiraIssue/applyTransition",!1,{orgId:t.currentOrgId}).patch("",{transitionId:n}).then(function(t){var n=u().module.ticket[e].jiraBugInfo;return r()(n.issueInfo,{issueStatusCategory:o,issueStatus:a}),{entities:{ticket:s()({},e,{jiraBugInfo:n})},result:[]}})}}}function m(e){return{types:Object(u.m)("GET_PROJECT_FILEBUG_BETA"),callAPI:function(t){return Object(i.a)("/api/v1/jira/projectsFileBugMeta?departmentId="+e,!1,{orgId:t.currentOrgId}).get().then(function(e){return e.projects})}}}function f(e){return{types:Object(u.m)("GET_JIRA_USERS"),callAPI:function(t){return Object(i.a)("/api/v1/jira/users?projectKey="+e,!1,{orgId:t.currentOrgId}).get().then(function(e){return e.data})}}}function g(e,t){var n="startsWith="+t;return e&&(n+="&fieldId="+e),{types:Object(u.m)("GET_SUGGESTION_LABELS"),callAPI:function(e){return Object(i.a)("/api/v1/jiraIssue/labels?"+n,!1,{orgId:e.currentOrgId}).get().then(function(e){return e.labels})}}}function I(e){return{type:"OPEN_JIRA_FORM",data:e}}function _(){return{type:"CLOSE_JIRA_FORM"}}},1757:function(e,t,n){e.exports={jiraContainer:"JiraLeftPanel-module__jiraContainer common-module__flexgrow",jiraHead:"JiraLeftPanel-module__jiraHead",titleHead:"JiraLeftPanel-module__titleHead common-module__dflex",bugName:"JiraLeftPanel-module__bugName common-module__semibold common-module__ftsmooth common-module__flexgrow",newTab:"JiraLeftPanel-module__newTab",jiraDetails:"JiraLeftPanel-module__jiraDetails common-module__dotted common-module__oflow common-module__ellipsis",jiraContent:"JiraLeftPanel-module__jiraContent",jiraFooter:"JiraLeftPanel-module__jiraFooter common-module__dflex",delinkButtom:"JiraLeftPanel-module__delinkButtom"}},684:function(e,t,n){"use strict";n.r(t);var a=n(12),r=n.n(a),o=n(9),s=n.n(o),i=n(10),u=n.n(i),l=n(13),c=n.n(l),d=n(14),p=n.n(d),m=n(0),f=n.n(m),g=n(1),I=n.n(g),_=n(26),j=n(1323),h=n(24),k=n(8),O=n(1757),C=n.n(O),v=n(16),y=n(30),E=n(73),b=n.n(E),B=n(1228),P=n(109),N=function(e){function t(e){s()(this,t);var n=c()(this,(t.__proto__||r()(t)).call(this,e));return n.state={},n.openOrCloseBug=n.openOrCloseBug.bind(n),n}return p()(t,e),u()(t,[{key:"openOrCloseBug",value:function(){var e=this;this.setState({actionStatus:"loading"}),this.props.openOrCloseBug().then(function(){e.setState({actionStatus:"none"})},function(){e.setState({actionStatus:"none"})})}},{key:"render",value:function(){var e=this.state.actionStatus,t=void 0===e?"none":e,n=this.props,a=n.haveClosePer,r=n.info,o=n.isReadOnly,s=n.delinkBug,i=(n.openOrCloseBug,r.issueKey),u=r.issueInfoUrl,l=r.issueTitle,c=r.issueType,d=r.assignee,p=r.reporter,m=r.priority,g=r.issueStatus,I=r.issueStatusCategory;return f.a.createElement(v.Container,null,f.a.createElement(v.Box,{className:C.a.jiraContainer,flexible:!0,scroll:"vertical"},f.a.createElement("div",{className:C.a.jiraHead},f.a.createElement(P.a,{className:C.a.titleHead,href:u,target:"_blank"},f.a.createElement("span",{className:C.a.bugName},i),f.a.createElement("span",{className:C.a.newTab},f.a.createElement(y.TopbandFontIcon,{isBold:!0,name:"newtab",size:"14"}))),f.a.createElement("span",{className:C.a.jiraDetails},l)),f.a.createElement("div",{className:C.a.jiraContent},f.a.createElement(B.a,{text:k.f.getI18NValue("support.integ.jira.project")},f.a.createElement("span",null,i.split("-")[0])),f.a.createElement(B.a,{text:k.f.getI18NValue("support.integ.jira.issueType")},f.a.createElement("span",null,c)),d?f.a.createElement(B.a,{text:k.f.getI18NValue("support.integ.jira.assignee")},f.a.createElement("span",null,d.name)):null,f.a.createElement(B.a,{text:k.f.getI18NValue("support.integ.jira.reporter")},f.a.createElement("span",null,p.name)),f.a.createElement(B.a,{text:k.f.getI18NValue("support.integ.jira.issue.priority")},f.a.createElement("span",null,m.name)),f.a.createElement(B.a,{text:k.f.getI18NValue("support.integ.jira.issue.status")},f.a.createElement("span",null,g)))),o?null:f.a.createElement(v.Box,{className:C.a.jiraFooter},f.a.createElement(b.a,{disabled:!a,onClick:this.openOrCloseBug,palette:"primaryFilled",status:t,text:k.f.getI18NValue("done"==I?"support.integ.jira.reopen.issue":"support.integ.jira.close.issue")}),f.a.createElement("span",{className:C.a.delinkButtom},f.a.createElement(b.a,{onClick:s,palette:"secondary",text:k.f.getI18NValue("support.integ.jira.bug.delink")}))))}}]),t}(f.a.Component),S=N;N.propTypes={delinkBug:I.a.func,haveClosePer:I.a.bool,info:I.a.object,isReadOnly:I.a.bool,openOrCloseBug:I.a.func};var x=function(e){function t(e){s()(this,t);var n=c()(this,(t.__proto__||r()(t)).call(this,e));return n.state={haveClosePer:!0},n.openOrCloseBug=n.openOrCloseBug.bind(n),n.checkHaveClosePer=n.checkHaveClosePer.bind(n),n}return p()(t,e),u()(t,[{key:"componentDidUpdate",value:function(e,t){e.jiraBugInfo.bugStatusCategory!=this.props.jiraBugInfo.bugStatusCategory&&this.checkHaveClosePer()}},{key:"componentDidMount",value:function(){this.checkHaveClosePer()}},{key:"checkHaveClosePer",value:function(){for(var e=this.props.jiraBugInfo,t=e.issueInfo,n=e.transitionInfo,a="new"==t.issueStatusCategory?"done":"new",r=null,o=0;o<n.length;o++){var s=n[o];a==s.issueStatusCategory&&(r=s)}r?this.setState({haveClosePer:!0,transitionObj:r,transitionId:r.transitionId,transitionStatus:a}):this.setState({haveClosePer:!1})}},{key:"openOrCloseBug",value:function(){var e=this,t=this.props,n=t.ticketId,a=t.openOrCloseBug,r=t.showMessage,o=this.state.transitionObj;return a(n,o).then(function(){"new"==o.issueStatusCategory?r({type:"success",message:k.f.getI18NValue("support.integ.jira.issue.reopened")}):r({type:"success",message:k.f.getI18NValue("support.integ.jira.issue.closed")}),e.checkHaveClosePer()},function(){r({type:"alert",message:k.f.getI18NValue("support.unable.to.process.your.request")})})}},{key:"render",value:function(){var e=this.props,t=e.jiraBugInfo,n=e.isReadOnly,a=e.delinkBug,r=this.state.haveClosePer;return f.a.createElement(S,{info:t.issueInfo,isReadOnly:n,haveClosePer:r,delinkBug:a,openOrCloseBug:this.openOrCloseBug})}}]),t}(m.Component);x.propTypes={delinkBug:I.a.func,isReadOnly:I.a.bool,jiraBugInfo:I.a.object,openOrCloseBug:I.a.func,showMessage:I.a.func,ticketId:I.a.string};t.default=Object(_.connect)(function(e,t){return{jiraBugInfo:e.module.ticket[t.ticketId].jiraBugInfo}},{openOrCloseBug:j.i,showMessage:h.Q})(x)}}]);